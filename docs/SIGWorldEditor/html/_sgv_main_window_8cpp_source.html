<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SIGWorldEditor: SgvMainWindow.cpp ソースファイル</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- 作成： Doxygen 1.5.9 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>メインページ</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li><a href="annotated.html"><span>クラス</span></a></li>
      <li class="current"><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>ファイル一覧</span></a></li>
      <li><a href="globals.html"><span>ファイルメンバ</span></a></li>
    </ul>
  </div>
<h1>SgvMainWindow.cpp</h1><a href="_sgv_main_window_8cpp.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="_win_main_8h.html">WinMain.h</a>"</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include "<a class="code" href="_sgv_main_window_8h.html">SgvMainWindow.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include "<a class="code" href="_sgv_ogre_client_window_8h.html">SgvOgreClientWindow.h</a>"</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include "<a class="code" href="_sgv_class_editor_window_8h.html">SgvClassEditorWindow.h</a>"</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include "<a class="code" href="_sgv_ogre_x3_d_preview_window_8h.html">SgvOgreX3DPreviewWindow.h</a>"</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include "Ogre.h"</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="_sgv_cmd_string_8h.html">SgvCmdString.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="_sgv_startup_file_8h.html">SgvStartupFile.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="_sgv_sys_settings_8h.html">SgvSysSettings.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="_sgv_x3_d_8h.html">SgvX3D.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="_sgv_x_m_l_util_8h.html">SgvXMLUtil.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include "<a class="code" href="_sgv_file_util_8h.html">SgvFileUtil.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="_sgv_string_util_8h.html">SgvStringUtil.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="_sgv_log_8h.html">SgvLog.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="_wgu_8h.html">Wgu.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="resource_8h.html">resource.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;commctrl.h&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a><a class="code" href="_sgv_main_window_8cpp.html#2ffb8877e04e2296cd2810946a47597d">00023</a> <span class="preprocessor">#define STARTUP_CONFIG_FILE "SIGWE_startup.cfg"</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="keyword">using namespace </span>Ogre;
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keyword">namespace </span>Sgv
<a name="l00028"></a>00028 {
<a name="l00029"></a><a class="code" href="class_sgv_1_1_main_window.html#bff5cdf19ccf9c2411772c61521b4f9e">00029</a>     <a class="code" href="class_sgv_1_1_main_window.html#bff5cdf19ccf9c2411772c61521b4f9e" title="コンストラクタ">MainWindow::MainWindow</a>(HINSTANCE hInst, LPSTR strCmdLine)
<a name="l00030"></a>00030     {
<a name="l00031"></a>00031         <span class="comment">// ------------------------------------------</span>
<a name="l00032"></a>00032         <span class="comment">//  メンバ変数初期化</span>
<a name="l00033"></a>00033         <span class="comment">// ------------------------------------------</span>
<a name="l00034"></a>00034         m_hInst = hInst;
<a name="l00035"></a>00035         m_hwndMain = NULL;
<a name="l00036"></a>00036         m_hwndStatus = NULL;
<a name="l00037"></a>00037         m_pX3D = NULL;
<a name="l00038"></a>00038 
<a name="l00039"></a>00039         m_pOgreClientWindow = NULL;
<a name="l00040"></a>00040         m_pSceneMgr = NULL;
<a name="l00041"></a>00041         m_pRootNode = NULL;
<a name="l00042"></a>00042         m_pMainShapeNode = NULL;
<a name="l00043"></a>00043         m_pOtherShapeNode = NULL;
<a name="l00044"></a>00044         m_pRenderWindow = NULL;
<a name="l00045"></a>00045         m_pCamera = NULL;
<a name="l00046"></a>00046         m_RaySceneQuery = NULL;
<a name="l00047"></a>00047         m_pClassEditorWindow = NULL;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         m_pRightPanel = NULL;
<a name="l00050"></a>00050         m_pBottomPanel = NULL;
<a name="l00051"></a>00051         m_cmdLine = strCmdLine;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053         m_MainCamInitialPos = Vector3(0, 30, 200);
<a name="l00054"></a>00054         m_MainCamInitialDir = Vector3(0, 0, -1);
<a name="l00055"></a>00055         m_BackGroundColor = ColourValue(0.5, 0.5, 0.7);
<a name="l00056"></a>00056         m_MsgWindowLimitTextSize = 0;
<a name="l00057"></a>00057         m_bShowGroundGrid = <span class="keyword">true</span>;
<a name="l00058"></a>00058         m_groundGridPlaneSize = 500;
<a name="l00059"></a>00059         m_groundGridSize = 20;
<a name="l00060"></a>00060         m_bShowAxisArrow = <span class="keyword">true</span>;
<a name="l00061"></a>00061         m_axisArrowLength = 10;
<a name="l00062"></a>00062         m_bShowTestControls = <span class="keyword">false</span>;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064         m_bKeyPressing = <span class="keyword">false</span>;
<a name="l00065"></a>00065         m_bShapeAddMode = <span class="keyword">false</span>;
<a name="l00066"></a>00066         m_winSizing = <span class="keyword">false</span>;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         m_currSelected = <span class="keyword">false</span>;
<a name="l00069"></a>00069         m_currSelectedEntName = <span class="stringliteral">""</span>;
<a name="l00070"></a>00070         m_currSelectedEntityIsHumanoid = <span class="keyword">false</span>;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <span class="comment">// XMLWorldにClassManagerをセット</span>
<a name="l00073"></a>00073         m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#989446cc5498eb5f4a936f3fafd3bdd2" title="エンティティクラスマネージャをセットする">setXMLEntityClassManager</a>(&amp;m_entClassMgr);
<a name="l00074"></a>00074 
<a name="l00075"></a>00075         <span class="comment">// ------------------------------------------</span>
<a name="l00076"></a>00076         <span class="comment">//  ログ初期化</span>
<a name="l00077"></a>00077         <span class="comment">// ------------------------------------------</span>
<a name="l00078"></a>00078         m_pFileLog = <span class="keyword">new</span> <a class="code" href="class_sgv_1_1_file_log_listener.html" title="ファイルログ">FileLogListener</a>();
<a name="l00079"></a>00079         m_pFileLog-&gt;<a class="code" href="class_sgv_1_1_file_log_listener.html#19d156e5958e261d98f22a0e36a77749" title="ログファイルを開く">open</a>(<span class="stringliteral">"SIGWorldEditor.log"</span>);
<a name="l00080"></a>00080         <a class="code" href="namespace_sgv.html#1ecea1a6b5fc4ac3bd512b2d7f9082c3" title="システムで唯一のログマネージャオブジェクトを取得する">getLog</a>().<a class="code" href="class_sgv_1_1_log.html#d640d01e746b28f2cb22c3e524879261" title="ログリスナー（＝ログの出力先）を追加する">addListener</a>(m_pFileLog);
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="class_sgv_1_1_main_window.html#b99a0936f61d70889739462101fc635f">00083</a>     <a class="code" href="class_sgv_1_1_main_window.html#b99a0936f61d70889739462101fc635f" title="デストラクタ">MainWindow::‾MainWindow</a>()
<a name="l00084"></a>00084     {
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="class_sgv_1_1_main_window.html#6f394c4e4ce52e0194d8daecdb6d9bd8">00087</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#6f394c4e4ce52e0194d8daecdb6d9bd8" title="前回起動時の設定状態保存ファイル(SIGWE_settings.sav)を読み込む...">MainWindow::readSettingsFile</a>()
<a name="l00088"></a>00088     {
<a name="l00089"></a>00089         <span class="comment">// ------------------------------------------------------------</span>
<a name="l00090"></a>00090         <span class="comment">//  前回起動時の設定状態の保存ファイルを読み込む</span>
<a name="l00091"></a>00091         <span class="comment">// ------------------------------------------------------------</span>
<a name="l00092"></a>00092         <span class="keywordflow">if</span> (m_settings.<a class="code" href="class_sgv_1_1_sys_settings.html#f399575931012ace5cf6ba2cecbd2c79" title="設定ファイルをロードする．">load</a>())
<a name="l00093"></a>00093         {
<a name="l00094"></a>00094             <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"Last setting file (%s) was loaded."</span>, m_settings.<a class="code" href="class_sgv_1_1_sys_settings.html#cf61e523415407128e288edabf80b99b" title="現在の設定ファイル名を得る">getSettingFileName</a>());
<a name="l00095"></a>00095         }
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="class_sgv_1_1_main_window.html#bf9be714baf6b1346f9843d35a843337">00098</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#bf9be714baf6b1346f9843d35a843337" title="現在の設定値をSIGWE_settings.savに書き込む">MainWindow::saveSettingsFile</a>()
<a name="l00099"></a>00099     {
<a name="l00100"></a>00100         <span class="comment">// ------------------------------------------------------------</span>
<a name="l00101"></a>00101         <span class="comment">//  カメラの視点位置、方向をセーブ</span>
<a name="l00102"></a>00102         <span class="comment">// ------------------------------------------------------------</span>
<a name="l00103"></a>00103         <span class="keywordflow">if</span> (m_pCamera)
<a name="l00104"></a>00104         {
<a name="l00105"></a>00105             <span class="keywordtype">char</span> buf[256];
<a name="l00106"></a>00106 
<a name="l00107"></a>00107             <span class="comment">// 位置</span>
<a name="l00108"></a>00108             Vector3 pos = m_pCamera-&gt;getPosition();
<a name="l00109"></a>00109             sprintf(buf, <span class="stringliteral">"(%f, %f, %f)"</span>, pos.x, pos.y, pos.z);
<a name="l00110"></a>00110             m_settings.<a class="code" href="class_sgv_1_1_sys_settings.html#f9be3a5e1263a4a61e60c8eaa843f8ad" title="キーに対する値を設定する">setValue</a>(<span class="stringliteral">"MAIN_CAMERA_INIT_POS"</span>, buf);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112             <span class="comment">// 方向</span>
<a name="l00113"></a>00113             Vector3 dir = m_pCamera-&gt;getDirection();
<a name="l00114"></a>00114             sprintf(buf, <span class="stringliteral">"(%f, %f, %f)"</span>, dir.x, dir.y, dir.z);
<a name="l00115"></a>00115             m_settings.<a class="code" href="class_sgv_1_1_sys_settings.html#f9be3a5e1263a4a61e60c8eaa843f8ad" title="キーに対する値を設定する">setValue</a>(<span class="stringliteral">"MAIN_CAMERA_INIT_DIR"</span>, buf);
<a name="l00116"></a>00116         }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118         <span class="comment">// セーブ</span>
<a name="l00119"></a>00119         m_settings.<a class="code" href="class_sgv_1_1_sys_settings.html#0c7ed0a148e062ef8c1095f89b39bd38" title="現在の保持内容を設定ファイルにセーブする">save</a>();
<a name="l00120"></a>00120     }
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="class_sgv_1_1_main_window.html#f38fbf4b332b82b3c7908c6834bcb90c">00122</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#f38fbf4b332b82b3c7908c6834bcb90c" title="設定ファイル(SIGWE_startup.cfg)を読み込む">MainWindow::readStartupConfigFile</a>()
<a name="l00123"></a>00123     {
<a name="l00124"></a>00124         <a class="code" href="class_sgv_1_1_startup_file.html" title="設定ファイルクラス．SIGWorldEditorの起動時に読み込まれる．">StartupFile</a> cf;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"STARTUP_CONFIG_FILE : (%s)"</span>, <a class="code" href="_sgv_main_window_8cpp.html#2ffb8877e04e2296cd2810946a47597d">STARTUP_CONFIG_FILE</a>);
<a name="l00127"></a>00127 
<a name="l00128"></a>00128         <span class="keyword">const</span> <span class="keywordtype">char</span> *campos = NULL;
<a name="l00129"></a>00129         <span class="keyword">const</span> <span class="keywordtype">char</span> *camdir = NULL;
<a name="l00130"></a>00130         <span class="keyword">const</span> <span class="keywordtype">char</span> *backGroundColor = NULL;
<a name="l00131"></a>00131         <span class="keyword">const</span> <span class="keywordtype">char</span> *msgWindowLimitTextSize = NULL;
<a name="l00132"></a>00132         <span class="keyword">const</span> <span class="keywordtype">char</span> *showGroundGrid = NULL;
<a name="l00133"></a>00133         <span class="keyword">const</span> <span class="keywordtype">char</span> *groundGridPlaneSize = NULL;
<a name="l00134"></a>00134         <span class="keyword">const</span> <span class="keywordtype">char</span> *groundGridSize = NULL;
<a name="l00135"></a>00135         <span class="keyword">const</span> <span class="keywordtype">char</span> *showAxisArrow = NULL;
<a name="l00136"></a>00136         <span class="keyword">const</span> <span class="keywordtype">char</span> *axisArrowLength = NULL;
<a name="l00137"></a>00137         <span class="keyword">const</span> <span class="keywordtype">char</span> *showTestControls = NULL;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         <span class="keywordflow">if</span> (m_settings.<a class="code" href="class_sgv_1_1_sys_settings.html#97fb5e80e76295412f733854800d084f" title="設定ファイルのロードが成功したか？を返す">loaded</a>())
<a name="l00140"></a>00140         {
<a name="l00141"></a>00141             <span class="comment">// 設定保存ファイルから読み込む項目</span>
<a name="l00142"></a>00142             campos = m_settings.<a class="code" href="class_sgv_1_1_sys_settings.html#1effee610b90981bbed3dba38f99a756" title="キーに対応する値を返す">getValue</a>(<span class="stringliteral">"MAIN_CAMERA_INIT_POS"</span>);
<a name="l00143"></a>00143             camdir = m_settings.<a class="code" href="class_sgv_1_1_sys_settings.html#1effee610b90981bbed3dba38f99a756" title="キーに対応する値を返す">getValue</a>(<span class="stringliteral">"MAIN_CAMERA_INIT_DIR"</span>);
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146         <span class="keywordflow">if</span> (cf.<a class="code" href="class_sgv_1_1_startup_file.html#53a160058edbf766959e199136634a48" title="設定ファイルを読み込む">load</a>(<a class="code" href="_sgv_main_window_8cpp.html#2ffb8877e04e2296cd2810946a47597d">STARTUP_CONFIG_FILE</a>))
<a name="l00147"></a>00147         {
<a name="l00148"></a>00148             <span class="keywordflow">if</span> (!m_settings.<a class="code" href="class_sgv_1_1_sys_settings.html#97fb5e80e76295412f733854800d084f" title="設定ファイルのロードが成功したか？を返す">loaded</a>())
<a name="l00149"></a>00149             {
<a name="l00150"></a>00150                 <span class="comment">// 設定保存ファイルがない場合に</span>
<a name="l00151"></a>00151                 <span class="comment">// SIGWE_startup.cfgの値を設定する項目</span>
<a name="l00152"></a>00152                 campos = cf.<a class="code" href="class_sgv_1_1_startup_file.html#f86dde5e78477c88dbda6b32f9018d9e" title="キーに対応する値を返す．">getStringValue</a>(<span class="stringliteral">"MAIN_CAMERA_INIT_POS"</span>);
<a name="l00153"></a>00153                 camdir = cf.<a class="code" href="class_sgv_1_1_startup_file.html#f86dde5e78477c88dbda6b32f9018d9e" title="キーに対応する値を返す．">getStringValue</a>(<span class="stringliteral">"MAIN_CAMERA_INIT_DIR"</span>);
<a name="l00154"></a>00154             }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156             backGroundColor = cf.<a class="code" href="class_sgv_1_1_startup_file.html#f86dde5e78477c88dbda6b32f9018d9e" title="キーに対応する値を返す．">getStringValue</a>(<span class="stringliteral">"BACK_GROUND_COLOR"</span>);
<a name="l00157"></a>00157             msgWindowLimitTextSize = cf.<a class="code" href="class_sgv_1_1_startup_file.html#f86dde5e78477c88dbda6b32f9018d9e" title="キーに対応する値を返す．">getStringValue</a>(<span class="stringliteral">"MSG_WINDOW_LIMIT_TEXT_SIZE"</span>);
<a name="l00158"></a>00158             showGroundGrid = cf.<a class="code" href="class_sgv_1_1_startup_file.html#f86dde5e78477c88dbda6b32f9018d9e" title="キーに対応する値を返す．">getStringValue</a>(<span class="stringliteral">"SHOW_GROUND_GRID"</span>);
<a name="l00159"></a>00159             groundGridPlaneSize = cf.<a class="code" href="class_sgv_1_1_startup_file.html#f86dde5e78477c88dbda6b32f9018d9e" title="キーに対応する値を返す．">getStringValue</a>(<span class="stringliteral">"GROUND_GRID_PLANE_SIZE"</span>);
<a name="l00160"></a>00160             groundGridSize = cf.<a class="code" href="class_sgv_1_1_startup_file.html#f86dde5e78477c88dbda6b32f9018d9e" title="キーに対応する値を返す．">getStringValue</a>(<span class="stringliteral">"GROUND_GRID_SIZE"</span>);
<a name="l00161"></a>00161             showAxisArrow = cf.<a class="code" href="class_sgv_1_1_startup_file.html#f86dde5e78477c88dbda6b32f9018d9e" title="キーに対応する値を返す．">getStringValue</a>(<span class="stringliteral">"SHOW_AXIS_ARROW"</span>);
<a name="l00162"></a>00162             axisArrowLength = cf.<a class="code" href="class_sgv_1_1_startup_file.html#f86dde5e78477c88dbda6b32f9018d9e" title="キーに対応する値を返す．">getStringValue</a>(<span class="stringliteral">"AXIS_ARROW_LENGTH"</span>);
<a name="l00163"></a>00163             showTestControls = cf.<a class="code" href="class_sgv_1_1_startup_file.html#f86dde5e78477c88dbda6b32f9018d9e" title="キーに対応する値を返す．">getStringValue</a>(<span class="stringliteral">"SHOW_TEST_CONTROLS"</span>);
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"** MAIN_CAMERA_INIT_POS (%s)"</span>, campos ? campos : <span class="stringliteral">"NULL"</span>);
<a name="l00167"></a>00167         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"** MAIN_CAMERA_INIT_DIR (%s)"</span>, camdir ? camdir : <span class="stringliteral">"NULL"</span>);
<a name="l00168"></a>00168         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"** BACK_GROUND_COLOR (%s)"</span>, backGroundColor ? backGroundColor : <span class="stringliteral">"NULL"</span>);
<a name="l00169"></a>00169         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"** MSG_WINDOW_LIMIT_TEXT_SIZE (%s)"</span>, msgWindowLimitTextSize ? msgWindowLimitTextSize : <span class="stringliteral">"NULL"</span>);
<a name="l00170"></a>00170         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"** SHOW_GROUND_GRID (%s)"</span>, showGroundGrid ? showGroundGrid : <span class="stringliteral">"NULL"</span>);
<a name="l00171"></a>00171         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"** GROUND_GRID_PLANE_SIZE (%s)"</span>, groundGridPlaneSize ? groundGridPlaneSize : <span class="stringliteral">"NULL"</span>);
<a name="l00172"></a>00172         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"** GROUND_GRID_SIZE (%s)"</span>, groundGridSize ? groundGridSize : <span class="stringliteral">"NULL"</span>);
<a name="l00173"></a>00173         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"** SHOW_AXIS_ARROW (%s)"</span>, showAxisArrow ? showAxisArrow : <span class="stringliteral">"NULL"</span>);
<a name="l00174"></a>00174         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"** AXIS_ARROW_LENGTH (%s)"</span>, axisArrowLength ? axisArrowLength : <span class="stringliteral">"NULL"</span>);
<a name="l00175"></a>00175         <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Log::println</a>(<span class="stringliteral">"** SHOW_TEST_CONTROLS (%s)"</span>, showTestControls ? showTestControls : <span class="stringliteral">"NULL"</span>);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <span class="keywordflow">if</span> (campos)
<a name="l00178"></a>00178         {
<a name="l00179"></a>00179             <span class="keywordtype">double</span> x, y, z;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181             <span class="keywordflow">if</span> (<a class="code" href="namespace_sgv.html#eb2eb42eb8226247f538e5896b97441b" title="3次元ベクトルを表す文字列をパースする">parseVector3</a>(campos, x, y, z))
<a name="l00182"></a>00182             {
<a name="l00183"></a>00183                 m_MainCamInitialPos = Vector3(x, y, z);
<a name="l00184"></a>00184             }
<a name="l00185"></a>00185         }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="keywordflow">if</span> (camdir)
<a name="l00188"></a>00188         {
<a name="l00189"></a>00189             <span class="keywordtype">double</span> x, y, z;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191             <span class="keywordflow">if</span> (<a class="code" href="namespace_sgv.html#eb2eb42eb8226247f538e5896b97441b" title="3次元ベクトルを表す文字列をパースする">parseVector3</a>(camdir, x, y, z))
<a name="l00192"></a>00192             {
<a name="l00193"></a>00193                 m_MainCamInitialDir = Vector3(x, y, z);
<a name="l00194"></a>00194             }
<a name="l00195"></a>00195         }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197         <span class="keywordflow">if</span> (backGroundColor)
<a name="l00198"></a>00198         {
<a name="l00199"></a>00199             <span class="keywordtype">double</span> r, g, b;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201             <span class="keywordflow">if</span> (<a class="code" href="namespace_sgv.html#eb2eb42eb8226247f538e5896b97441b" title="3次元ベクトルを表す文字列をパースする">parseVector3</a>(backGroundColor, r, g, b))
<a name="l00202"></a>00202             {
<a name="l00203"></a>00203                 m_BackGroundColor = ColourValue(r, g, b);
<a name="l00204"></a>00204             }
<a name="l00205"></a>00205         }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         <span class="keywordflow">if</span> (msgWindowLimitTextSize)
<a name="l00208"></a>00208         {
<a name="l00209"></a>00209             m_MsgWindowLimitTextSize = atoi(msgWindowLimitTextSize);
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <span class="keywordflow">if</span> (showGroundGrid)
<a name="l00213"></a>00213         {
<a name="l00214"></a>00214             m_bShowGroundGrid = toBoolean(showGroundGrid, <span class="keyword">true</span>);
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (groundGridPlaneSize)
<a name="l00218"></a>00218         {
<a name="l00219"></a>00219             m_groundGridPlaneSize = atoi(groundGridPlaneSize);
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222         <span class="keywordflow">if</span> (groundGridSize)
<a name="l00223"></a>00223         {
<a name="l00224"></a>00224             m_groundGridSize = atoi(groundGridSize);
<a name="l00225"></a>00225         }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         <span class="keywordflow">if</span> (showAxisArrow)
<a name="l00228"></a>00228         {
<a name="l00229"></a>00229             m_bShowAxisArrow = toBoolean(showAxisArrow, <span class="keyword">true</span>);
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         <span class="keywordflow">if</span> (axisArrowLength)
<a name="l00233"></a>00233         {
<a name="l00234"></a>00234             m_axisArrowLength = atoi(axisArrowLength);
<a name="l00235"></a>00235         }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237         <span class="keywordflow">if</span> (showTestControls)
<a name="l00238"></a>00238         {
<a name="l00239"></a>00239             m_bShowTestControls = toBoolean(showTestControls, <span class="keyword">false</span>);
<a name="l00240"></a>00240         }
<a name="l00241"></a>00241     }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="keywordtype">bool</span> MainWindow::toBoolean(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keywordtype">bool</span> defaultValue)
<a name="l00244"></a>00244     {
<a name="l00245"></a>00245         <span class="keywordtype">bool</span> retVal = defaultValue;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247         <span class="keywordflow">if</span> (s)
<a name="l00248"></a>00248         {
<a name="l00249"></a>00249             <span class="keywordflow">if</span> (strcmp(s, <span class="stringliteral">"true"</span>)==0)
<a name="l00250"></a>00250             {
<a name="l00251"></a>00251                 retVal = <span class="keyword">true</span>;
<a name="l00252"></a>00252             }
<a name="l00253"></a>00253             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(s, <span class="stringliteral">"false"</span>)==0)
<a name="l00254"></a>00254             {
<a name="l00255"></a>00255                 retVal = <span class="keyword">false</span>;
<a name="l00256"></a>00256             }
<a name="l00257"></a>00257         }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         <span class="keywordflow">return</span> retVal;
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261 
<a name="l00262"></a><a class="code" href="class_sgv_1_1_main_window.html#b0125985efb1940d01cb4c541e6abafb">00262</a>     <span class="keywordtype">bool</span> <a class="code" href="class_sgv_1_1_main_window.html#b0125985efb1940d01cb4c541e6abafb" title="SIGWorldEditorシステムを初期化する.">MainWindow::init</a>()
<a name="l00263"></a>00263     {
<a name="l00264"></a>00264         <span class="comment">// ----------------------------------------------</span>
<a name="l00265"></a>00265         <span class="comment">//  前回起動時の設定保存ファイル読み込み</span>
<a name="l00266"></a>00266         <span class="comment">// ----------------------------------------------</span>
<a name="l00267"></a>00267         <a class="code" href="class_sgv_1_1_main_window.html#6f394c4e4ce52e0194d8daecdb6d9bd8" title="前回起動時の設定状態保存ファイル(SIGWE_settings.sav)を読み込む...">readSettingsFile</a>();
<a name="l00268"></a>00268 
<a name="l00269"></a>00269         <span class="comment">// ----------------------------------------------</span>
<a name="l00270"></a>00270         <span class="comment">//  設定ファイル読み込み</span>
<a name="l00271"></a>00271         <span class="comment">// ----------------------------------------------</span>
<a name="l00272"></a>00272         <a class="code" href="class_sgv_1_1_main_window.html#f38fbf4b332b82b3c7908c6834bcb90c" title="設定ファイル(SIGWE_startup.cfg)を読み込む">readStartupConfigFile</a>();
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         <span class="comment">// ----------------------------------------------</span>
<a name="l00275"></a>00275         <span class="comment">//  コマンドライン引数をログへ記録</span>
<a name="l00276"></a>00276         <span class="comment">// ----------------------------------------------</span>
<a name="l00277"></a>00277         <a class="code" href="class_sgv_1_1_cmd_string.html" title="コマンドライン引数の解析用クラス">CmdString</a> cmd(m_cmdLine.c_str());
<a name="l00278"></a>00278         <a class="code" href="class_sgv_1_1_log.html#8134cbda3265eacd0bbbd9dc1a261359" title="ログへ文字列を出力（書式指定可能．改行なし）">Log::print</a>(<span class="stringliteral">"Number of args : %d¥n"</span>, cmd.count());
<a name="l00279"></a>00279         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> icmd=0; icmd&lt;cmd.count(); icmd++)
<a name="l00280"></a>00280         {
<a name="l00281"></a>00281             <a class="code" href="class_sgv_1_1_log.html#8134cbda3265eacd0bbbd9dc1a261359" title="ログへ文字列を出力（書式指定可能．改行なし）">Log::print</a>(<span class="stringliteral">"[%d] (%s)¥n"</span>, icmd, cmd.get(icmd));
<a name="l00282"></a>00282         }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="comment">// ----------------------------------------------</span>
<a name="l00285"></a>00285         <span class="comment">//  XMLエンジン初期化</span>
<a name="l00286"></a>00286         <span class="comment">// ----------------------------------------------</span>
<a name="l00287"></a>00287         <a class="code" href="namespace_sgv.html#58ae38306bf17007bae9e10ad691a9c6" title="XMLエンジン(Xerces)を初期化する.">Sgv::initXMLEngine</a>();
<a name="l00288"></a>00288 
<a name="l00289"></a>00289         <span class="comment">// ----------------------------------------------</span>
<a name="l00290"></a>00290         <span class="comment">//  X3Dセットアップ</span>
<a name="l00291"></a>00291         <span class="comment">// ----------------------------------------------</span>
<a name="l00292"></a>00292         m_pX3D = <span class="keyword">new</span> <a class="code" href="class_sgv_1_1_x3_d.html" title="X3Dクラス.">Sgv::X3D</a>();
<a name="l00293"></a>00293         <span class="keywordflow">if</span> (!m_pX3D-&gt;<a class="code" href="class_sgv_1_1_x3_d.html#d9bb1f6705d2b5f81dd884202e0d53f2" title="初期化">init</a>())
<a name="l00294"></a>00294         {
<a name="l00295"></a>00295             MessageBox(NULL, <span class="stringliteral">"failed to initalize Sgv::X3D object"</span>, <span class="stringliteral">"error"</span>, MB_OK | MB_ICONEXCLAMATION);
<a name="l00296"></a>00296             exit(1);
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         <span class="comment">// ----------------------------------------------</span>
<a name="l00300"></a>00300         <span class="comment">//  Ogreセットアップ</span>
<a name="l00301"></a>00301         <span class="comment">// ----------------------------------------------</span>
<a name="l00302"></a>00302         setupOgreSystem();
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="comment">// ----------------------------------------------</span>
<a name="l00305"></a>00305         <span class="comment">//  メインウィンドウ作成</span>
<a name="l00306"></a>00306         <span class="comment">// ----------------------------------------------</span>
<a name="l00307"></a>00307         <span class="keywordflow">if</span> (!create(<a class="code" href="resource_8h.html#5de1c451a9b9956280c5d48a9d0cb401">IDD_MAIN</a>, <span class="stringliteral">"MainDlg"</span>))
<a name="l00308"></a>00308         {
<a name="l00309"></a>00309             <a class="code" href="class_sgv_1_1_log.html#93dcad7dd4a6aa975f0430ed44851f59" title="ログへエラーメッセージを出力（書式指定可能．改行なし）...">Log::error</a>(<span class="stringliteral">"Main window create failed¥n"</span>);
<a name="l00310"></a>00310             exit(1);
<a name="l00311"></a>00311         }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313         <span class="comment">// ----------------------------------------------</span>
<a name="l00314"></a>00314         <span class="comment">//  クラスエディタウィンドウ作成</span>
<a name="l00315"></a>00315         <span class="comment">// ----------------------------------------------</span>
<a name="l00316"></a>00316         m_pClassEditorWindow = <span class="keyword">new</span> <a class="code" href="class_sgv_1_1_class_editor_window.html" title="クラスエディタウィンドウ">ClassEditorWindow</a>();
<a name="l00317"></a>00317         <span class="keywordflow">if</span> (!m_pClassEditorWindow-&gt;<a class="code" href="class_sgv_1_1_class_editor_window.html#6e027670f4f3ec9b73d94f05c7cc3bab" title="クラスエディタウィンドウを作成する">create</a>(<span class="keyword">this</span>, <a class="code" href="resource_8h.html#87d9b67923d233bffdfc1b915800eb67">IDD_CLASS_EDITOR</a>, <span class="stringliteral">"ClassEditor"</span>))
<a name="l00318"></a>00318         {
<a name="l00319"></a>00319             <a class="code" href="class_sgv_1_1_log.html#93dcad7dd4a6aa975f0430ed44851f59" title="ログへエラーメッセージを出力（書式指定可能．改行なし）...">Log::error</a>(<span class="stringliteral">"Class Editor create failed¥n"</span>);
<a name="l00320"></a>00320             exit(1);
<a name="l00321"></a>00321         }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323         <span class="comment">// ----------------------------------------------</span>
<a name="l00324"></a>00324         <span class="comment">//  パネル作成（右）</span>
<a name="l00325"></a>00325         <span class="comment">// ----------------------------------------------</span>
<a name="l00326"></a>00326         createRightPanel();
<a name="l00327"></a>00327 
<a name="l00328"></a>00328         <span class="comment">// ----------------------------------------------</span>
<a name="l00329"></a>00329         <span class="comment">//  パネル作成（下）</span>
<a name="l00330"></a>00330         <span class="comment">// ----------------------------------------------</span>
<a name="l00331"></a>00331         createBottomPanel();
<a name="l00332"></a>00332 
<a name="l00333"></a>00333         <span class="comment">// -----------------------------------------------------</span>
<a name="l00334"></a>00334         <span class="comment">//  パネル、クラスエディタウィンドウの表示内容の初期化</span>
<a name="l00335"></a>00335         <span class="comment">// -----------------------------------------------------</span>
<a name="l00336"></a>00336         initGuiContents();
<a name="l00337"></a>00337 
<a name="l00338"></a>00338         <span class="comment">// ----------------------------------------------</span>
<a name="l00339"></a>00339         <span class="comment">//  XMLファイルリスト作成</span>
<a name="l00340"></a>00340         <span class="comment">// ----------------------------------------------</span>
<a name="l00341"></a>00341         <a class="code" href="class_sgv_1_1_main_window.html#fd7d10da91726217361b4d0df02e9a31" title="カレントディレクトリにあるXMLファイルを検索し、 世界XMLファイル名、エ...">searchXMLFileList</a>();
<a name="l00342"></a>00342 
<a name="l00343"></a>00343         <span class="comment">// ----------------------------------------------</span>
<a name="l00344"></a>00344         <span class="comment">//  ウィンドウ表示</span>
<a name="l00345"></a>00345         <span class="comment">// ----------------------------------------------</span>
<a name="l00346"></a>00346         ShowWindow(m_hwndMain, SW_SHOW);
<a name="l00347"></a>00347         UpdateWindow(m_hwndMain);
<a name="l00348"></a>00348 
<a name="l00349"></a>00349         <span class="comment">// ----------------------------------------------</span>
<a name="l00350"></a>00350         <span class="comment">//  コントロールの位置調整＆</span>
<a name="l00351"></a>00351         <span class="comment">//  Ogreクライアントウィンドウ再描画</span>
<a name="l00352"></a>00352         <span class="comment">// ----------------------------------------------</span>
<a name="l00353"></a>00353         <a class="code" href="class_sgv_1_1_main_window.html#b9e2b81b65b5fd86b7b33a5b7a876779" title="パネルのサイズをメインウィンドウのサイズに合わせて変更する...">adjustControlPositions</a>();
<a name="l00354"></a>00354 
<a name="l00355"></a>00355         <span class="keywordflow">if</span> (m_pRenderWindow)
<a name="l00356"></a>00356         {
<a name="l00357"></a>00357             m_pRenderWindow-&gt;windowMovedOrResized();
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     <span class="keywordtype">bool</span> MainWindow::create(<span class="keywordtype">int</span> dialogResourceId, <span class="keywordtype">char</span> *dialogClassName)
<a name="l00364"></a>00364     {
<a name="l00365"></a>00365         <span class="comment">// ウィンドウクラス登録</span>
<a name="l00366"></a>00366         WNDCLASS wc;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368         wc.style = 0;
<a name="l00369"></a>00369         wc.lpfnWndProc = <a class="code" href="namespace_sgv.html#72b3084c3f7f764848131794877712d9">fMainWndProc</a>;
<a name="l00370"></a>00370         wc.cbClsExtra = 0;
<a name="l00371"></a>00371         wc.cbWndExtra = DLGWINDOWEXTRA;
<a name="l00372"></a>00372         wc.hInstance = m_hInst;
<a name="l00373"></a>00373         wc.hIcon = LoadIcon(0, IDI_APPLICATION);
<a name="l00374"></a>00374         wc.hCursor = LoadCursor(NULL, IDC_ARROW);
<a name="l00375"></a>00375         wc.hbrBackground = (HBRUSH)GetStockObject(LTGRAY_BRUSH);
<a name="l00376"></a>00376         wc.lpszMenuName = NULL;
<a name="l00377"></a>00377         wc.lpszClassName = dialogClassName;
<a name="l00378"></a>00378             <span class="comment">// ********** 重要！重要！重要！ *************</span>
<a name="l00379"></a>00379             <span class="comment">// wc.lpszClassNameと同じ名前を、.rcファイルの</span>
<a name="l00380"></a>00380             <span class="comment">// ダイアログテンプレートのところに</span>
<a name="l00381"></a>00381             <span class="comment">// CLASS "MainDlg"</span>
<a name="l00382"></a>00382             <span class="comment">// のように書いておかなければならない！！！</span>
<a name="l00383"></a>00383             <span class="comment">// （さもないと、下のCreateDialog()で失敗する）</span>
<a name="l00384"></a>00384             <span class="comment">// *******************************************</span>
<a name="l00385"></a>00385         RegisterClass(&amp;wc);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         <span class="comment">// ウィンドウ（＝ダイアログ）作成</span>
<a name="l00388"></a>00388         m_hwndMain = CreateDialog(
<a name="l00389"></a>00389             m_hInst,
<a name="l00390"></a>00390             MAKEINTRESOURCE(dialogResourceId),
<a name="l00391"></a>00391             0,
<a name="l00392"></a>00392             NULL);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394         <span class="keywordflow">if</span> (!m_hwndMain)
<a name="l00395"></a>00395         {
<a name="l00396"></a>00396             DWORD err = GetLastError();
<a name="l00397"></a>00397             <span class="keywordtype">char</span> buf[256];
<a name="l00398"></a>00398 
<a name="l00399"></a>00399             sprintf(buf, <span class="stringliteral">"CreateDialog failed. err=(0x0%x)"</span>, err);
<a name="l00400"></a>00400             MessageBox(NULL, buf, <span class="stringliteral">"error"</span>, MB_OK);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405         <span class="comment">// ----------------------------------------------</span>
<a name="l00406"></a>00406         <span class="comment">//  Ogreクライアントウィンドウ作成</span>
<a name="l00407"></a>00407         <span class="comment">// ----------------------------------------------</span>
<a name="l00408"></a>00408         m_pOgreClientWindow = <span class="keyword">new</span> <a class="code" href="class_sgv_1_1_ogre_client_window.html" title="メインウィンドウ内のOgre形状表示用ウィンドウ">Sgv::OgreClientWindow</a>();
<a name="l00409"></a>00409         m_pOgreClientWindow-&gt;<a class="code" href="class_sgv_1_1_ogre_client_window.html#d8991f80ea875bc1e9a9ec726e02019f" title="Ogreクライアントウィンドウを作成する.">create</a>(
<a name="l00410"></a>00410             m_hInst,
<a name="l00411"></a>00411             m_hwndMain,
<a name="l00412"></a>00412             10, 10,
<a name="l00413"></a>00413             400, 300
<a name="l00414"></a>00414         );
<a name="l00415"></a>00415 
<a name="l00416"></a>00416         <span class="comment">// ------------------------------------</span>
<a name="l00417"></a>00417         <span class="comment">//  Ogreの描画対象を、すでに作成された</span>
<a name="l00418"></a>00418         <span class="comment">//  win32のウィンドウにする</span>
<a name="l00419"></a>00419         <span class="comment">// ------------------------------------</span>
<a name="l00420"></a>00420         NameValuePairList options;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422         HWND hwndOgre = m_pOgreClientWindow-&gt;<a class="code" href="class_sgv_1_1_ogre_client_window.html#7c5d649dc0da35914b3d925671f487be" title="このウィンドウのウィンドウハンドルを返す">getHWND</a>();
<a name="l00423"></a>00423         options[<span class="stringliteral">"externalWindowHandle"</span>] = StringConverter::toString((<span class="keywordtype">size_t</span>)hwndOgre);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425         <span class="comment">// ------------------------------------</span>
<a name="l00426"></a>00426         <span class="comment">//  レンダーウィンドウ作成</span>
<a name="l00427"></a>00427         <span class="comment">// ------------------------------------</span>
<a name="l00428"></a>00428         m_pRenderWindow = m_root.createRenderWindow(
<a name="l00429"></a>00429             <span class="stringliteral">"embedded"</span>,
<a name="l00430"></a>00430             800,
<a name="l00431"></a>00431             600,
<a name="l00432"></a>00432             <span class="keyword">false</span>,
<a name="l00433"></a>00433             &amp;options);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435         <span class="comment">// ---------------------------------------------------</span>
<a name="l00436"></a>00436         <span class="comment">//  この行はレンダーウィンドウ作成後でないと失敗する</span>
<a name="l00437"></a>00437         <span class="comment">// ---------------------------------------------------</span>
<a name="l00438"></a>00438         ResourceGroupManager::getSingleton().initialiseAllResourceGroups();
<a name="l00439"></a>00439 
<a name="l00440"></a>00440         <span class="comment">// ------------------------------------</span>
<a name="l00441"></a>00441         <span class="comment">//  シーンマネージャ作成</span>
<a name="l00442"></a>00442         <span class="comment">// ------------------------------------</span>
<a name="l00443"></a>00443         m_pSceneMgr = m_root.createSceneManager(Ogre::ST_GENERIC, <span class="stringliteral">"default"</span>);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445         <span class="comment">// ------------------------------------</span>
<a name="l00446"></a>00446         <span class="comment">//  カメラ作成</span>
<a name="l00447"></a>00447         <span class="comment">// ------------------------------------</span>
<a name="l00448"></a>00448         m_pCamera = m_pSceneMgr-&gt;createCamera(<span class="stringliteral">"cam"</span>);
<a name="l00449"></a>00449         m_pCamera-&gt;setAutoAspectRatio(<span class="keyword">true</span>);
<a name="l00450"></a>00450         m_pCamera-&gt;setPosition(m_MainCamInitialPos);
<a name="l00451"></a>00451         m_pCamera-&gt;setDirection(m_MainCamInitialDir);
<a name="l00452"></a>00452         m_pCamera-&gt;setNearClipDistance(3);
<a name="l00453"></a>00453         m_pCamera-&gt;setFarClipDistance(5000);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455         <span class="comment">// ------------------------------------</span>
<a name="l00456"></a>00456         <span class="comment">//  ビューポート作成</span>
<a name="l00457"></a>00457         <span class="comment">// ------------------------------------</span>
<a name="l00458"></a>00458         Viewport* vp = m_pRenderWindow-&gt;addViewport(m_pCamera);
<a name="l00459"></a>00459         vp-&gt;setBackgroundColour(m_BackGroundColor);
<a name="l00460"></a>00460 
<a name="l00461"></a>00461         <span class="comment">// ------------------------------------</span>
<a name="l00462"></a>00462         <span class="comment">//  ライト作成</span>
<a name="l00463"></a>00463         <span class="comment">// ------------------------------------</span>
<a name="l00464"></a>00464         Light* l = m_pSceneMgr-&gt;createLight(<span class="stringliteral">"l"</span>);
<a name="l00465"></a>00465         l-&gt;setPosition(300, 100, -100);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         <span class="comment">// ----------------------------------------------</span>
<a name="l00468"></a>00468         <span class="comment">//  ルートノード作成</span>
<a name="l00469"></a>00469         <span class="comment">// ----------------------------------------------</span>
<a name="l00470"></a>00470         m_pRootNode = m_pSceneMgr-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l00471"></a>00471 
<a name="l00472"></a>00472         <span class="comment">// ----------------------------------------------</span>
<a name="l00473"></a>00473         <span class="comment">//  主要ノード作成</span>
<a name="l00474"></a>00474         <span class="comment">// ----------------------------------------------</span>
<a name="l00475"></a>00475         m_pMainShapeNode = m_pRootNode-&gt;createChildSceneNode();
<a name="l00476"></a>00476         m_pOtherShapeNode = m_pRootNode-&gt;createChildSceneNode();
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         <span class="comment">// ----------------------------------------------</span>
<a name="l00479"></a>00479         <span class="comment">//  その他の形状オブジェクト</span>
<a name="l00480"></a>00480         <span class="comment">// ----------------------------------------------</span>
<a name="l00481"></a>00481 
<a name="l00482"></a>00482         <span class="comment">// 地面</span>
<a name="l00483"></a>00483         <span class="keywordflow">if</span> (m_bShowGroundGrid)
<a name="l00484"></a>00484         {
<a name="l00485"></a>00485             SceneNode *ground = <a class="code" href="class_sgv_1_1_main_window.html#6a1e6d71c06a83154bafa68eab118af3" title="平面グリッドを作成する">createPlane</a>(m_pOtherShapeNode, m_groundGridPlaneSize, m_groundGridSize, <span class="stringliteral">"GroundPlane"</span>);
<a name="l00486"></a>00486         }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         <span class="keywordflow">if</span> (m_bShowAxisArrow)
<a name="l00489"></a>00489         {
<a name="l00490"></a>00490             <span class="comment">// x軸（赤)</span>
<a name="l00491"></a>00491             SceneNode *xArrow = <a class="code" href="class_sgv_1_1_main_window.html#fcc750e6018341297305b836c1a8e8b8" title="矢印を作成する">createArrow</a>(m_pOtherShapeNode, <span class="stringliteral">"x-axis"</span>, ColourValue(1.0f, 0.0f, 0.0f), m_axisArrowLength);
<a name="l00492"></a>00492             xArrow-&gt;setPosition(0, 0, 0);
<a name="l00493"></a>00493             xArrow-&gt;setDirection(1, 0, 0);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495             <span class="comment">// y軸（黄）</span>
<a name="l00496"></a>00496             SceneNode *yArrow = <a class="code" href="class_sgv_1_1_main_window.html#fcc750e6018341297305b836c1a8e8b8" title="矢印を作成する">createArrow</a>(m_pOtherShapeNode, <span class="stringliteral">"y-axis"</span>, ColourValue(1.0f, 1.0f, 0.0f), m_axisArrowLength);
<a name="l00497"></a>00497             yArrow-&gt;setPosition(0, 0, 0);
<a name="l00498"></a>00498             yArrow-&gt;setDirection(0, 1, 0);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500             <span class="comment">// z軸（緑）</span>
<a name="l00501"></a>00501             SceneNode *zArrow = <a class="code" href="class_sgv_1_1_main_window.html#fcc750e6018341297305b836c1a8e8b8" title="矢印を作成する">createArrow</a>(m_pOtherShapeNode, <span class="stringliteral">"z-axis"</span>, ColourValue(0.0f, 1.0f, 0.0f), m_axisArrowLength);
<a name="l00502"></a>00502             zArrow-&gt;setPosition(0, 0, 0);
<a name="l00503"></a>00503             zArrow-&gt;setDirection(0, 0, 1);
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508 
<a name="l00509"></a><a class="code" href="class_sgv_1_1_main_window.html#f0500d4c818e563d2108ce34cf28b3ca">00509</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#f0500d4c818e563d2108ce34cf28b3ca" title="クラスエディタウィンドウの表示状態を変更する">MainWindow::showClassEditorWindow</a>(<span class="keywordtype">bool</span> bShow)
<a name="l00510"></a>00510     {
<a name="l00511"></a>00511         <span class="keywordflow">if</span> (m_pClassEditorWindow)
<a name="l00512"></a>00512         {
<a name="l00513"></a>00513             m_pClassEditorWindow-&gt;<a class="code" href="class_sgv_1_1_class_editor_window.html#f100f2485900eafa8fd2a416309c0fc0" title="ウィンドウの表示・非表示の設定">show</a>(bShow);
<a name="l00514"></a>00514         }
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517     <span class="keywordtype">bool</span> MainWindow::setupOgreSystem()
<a name="l00518"></a>00518     {
<a name="l00519"></a>00519         <span class="comment">// ------------------------------------</span>
<a name="l00520"></a>00520         <span class="comment">//  プラグインロード</span>
<a name="l00521"></a>00521         <span class="comment">// ------------------------------------</span>
<a name="l00522"></a>00522 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l00523"></a>00523 <span class="preprocessor"></span>        m_root.loadPlugin(<span class="stringliteral">"RenderSystem_Direct3D9_d"</span>);
<a name="l00524"></a>00524         m_root.loadPlugin(<span class="stringliteral">"RenderSystem_GL_d"</span>);
<a name="l00525"></a>00525 <span class="preprocessor">#else</span>
<a name="l00526"></a>00526 <span class="preprocessor"></span>        m_root.loadPlugin(<span class="stringliteral">"RenderSystem_Direct3D9"</span>);
<a name="l00527"></a>00527         m_root.loadPlugin(<span class="stringliteral">"RenderSystem_GL"</span>);
<a name="l00528"></a>00528 <span class="preprocessor">#endif</span>
<a name="l00529"></a>00529 <span class="preprocessor"></span>
<a name="l00530"></a>00530         <span class="comment">// ------------------------------------</span>
<a name="l00531"></a>00531         <span class="comment">//  レンダーシステム初期化</span>
<a name="l00532"></a>00532         <span class="comment">// ------------------------------------</span>
<a name="l00533"></a>00533         m_root.setRenderSystem(*(m_root.getAvailableRenderers()-&gt;begin()));
<a name="l00534"></a>00534         m_root.initialise(<span class="keyword">false</span>);
<a name="l00535"></a>00535 
<a name="l00536"></a>00536         <span class="comment">// ------------------------------------</span>
<a name="l00537"></a>00537         <span class="comment">//  リソース初期化</span>
<a name="l00538"></a>00538         <span class="comment">// ------------------------------------</span>
<a name="l00539"></a>00539         ConfigFile cf;
<a name="l00540"></a>00540         cf.load(<span class="stringliteral">"resources.cfg"</span>);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542         ConfigFile::SectionIterator seci = cf.getSectionIterator();
<a name="l00543"></a>00543 
<a name="l00544"></a>00544         String secName, typeName, archName;
<a name="l00545"></a>00545         <span class="keywordflow">while</span> (seci.hasMoreElements())
<a name="l00546"></a>00546         {
<a name="l00547"></a>00547             secName = seci.peekNextKey();
<a name="l00548"></a>00548             ConfigFile::SettingsMultiMap *settings = seci.getNext();
<a name="l00549"></a>00549             ConfigFile::SettingsMultiMap::iterator i;
<a name="l00550"></a>00550             <span class="keywordflow">for</span> (i = settings-&gt;begin(); i != settings-&gt;end(); ++i)
<a name="l00551"></a>00551             {
<a name="l00552"></a>00552                 typeName = i-&gt;first;
<a name="l00553"></a>00553                 archName = i-&gt;second;
<a name="l00554"></a>00554                 ResourceGroupManager::getSingleton().addResourceLocation(
<a name="l00555"></a>00555                     archName, typeName, secName);
<a name="l00556"></a>00556             }
<a name="l00557"></a>00557         }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562     <span class="keywordtype">void</span> MainWindow::createRightPanel()
<a name="l00563"></a>00563     {
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (m_pRightPanel) <span class="keywordflow">return</span>;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566         <span class="comment">// 右パネルのベース</span>
<a name="l00567"></a>00567         m_pRightPanel = <span class="keyword">new</span> <a class="code" href="class_wgu_1_1_multi_panel.html" title="Win32 APIの簡易ラッパークラス（マルチパネル）.">Wgu::MultiPanel</a>(
<a name="l00568"></a>00568             GetDlgItem(m_hwndMain, <a class="code" href="resource_8h.html#bb803809b0cb522f1fcae0df236fbc0f">IDC_RIGHT_TAB</a>), <span class="keyword">true</span>);
<a name="l00569"></a>00569         <span class="keywordflow">if</span> (!m_pRightPanel) <span class="keywordflow">return</span>;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571         <span class="comment">// エンティティタブを右パネルに追加</span>
<a name="l00572"></a>00572         <a class="code" href="class_wgu_1_1_right_panel_proc___entity.html" title="パネルプロシージャクラス（右パネル：エンティティ）">Wgu::RightPanelProc_Entity</a> *prEnt = <span class="keyword">new</span> <a class="code" href="class_wgu_1_1_right_panel_proc___entity.html" title="パネルプロシージャクラス（右パネル：エンティティ）">Wgu::RightPanelProc_Entity</a>();
<a name="l00573"></a>00573         prEnt-&gt;<a class="code" href="class_wgu_1_1_base_panel_proc.html#e05f1a58e62beaf4d43d67afd383c691" title="ダイアログプロシージャをセットする">setDlgProc</a>(<a class="code" href="namespace_wgu.html#b8429081766f0f8769d483b25da08612">Wgu::PanelWndProc_Right_Entity</a>);
<a name="l00574"></a>00574         m_pRightPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#ab9adf45a86976327c7f09efbe8b7777" title="パネルを追加する">addPanel</a>(<span class="stringliteral">"Entity"</span>, <a class="code" href="resource_8h.html#3c83bf758b676e2c8a1489f3e4b065d1">IDD_RIGHT_ENTITY</a>, prEnt, 5, 25);
<a name="l00575"></a>00575 
<a name="l00576"></a>00576         <span class="comment">// ヒューマノイドタブを右パネルに追加</span>
<a name="l00577"></a>00577         <a class="code" href="class_wgu_1_1_right_panel_proc___humanoid.html" title="パネルプロシージャクラス（右パネル：ヒューマノイド）">Wgu::RightPanelProc_Humanoid</a> *prHu = <span class="keyword">new</span> <a class="code" href="class_wgu_1_1_right_panel_proc___humanoid.html" title="パネルプロシージャクラス（右パネル：ヒューマノイド）">Wgu::RightPanelProc_Humanoid</a>();
<a name="l00578"></a>00578         prHu-&gt;<a class="code" href="class_wgu_1_1_base_panel_proc.html#e05f1a58e62beaf4d43d67afd383c691" title="ダイアログプロシージャをセットする">setDlgProc</a>(<a class="code" href="namespace_wgu.html#2eaea06bbc5c053d3b6319dd607f4407">Wgu::PanelWndProc_Right_Humanoid</a>);
<a name="l00579"></a>00579         m_pRightPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#ab9adf45a86976327c7f09efbe8b7777" title="パネルを追加する">addPanel</a>(<span class="stringliteral">"Humanoid"</span>, <a class="code" href="resource_8h.html#5566444fb1fa99e41cf0742f157c3c75">IDD_RIGHT_HUMANOID</a>, prHu, 5, 25);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581         <span class="comment">// 初期状態ではエンティティタブを表示</span>
<a name="l00582"></a>00582         m_pRightPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#e920f231d122da567e0c93629f910f64" title="パネルを選択する">selectPanel</a>(RIGHT_PANEL::RP_ENTITY);
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <span class="keywordtype">void</span> MainWindow::createBottomPanel()
<a name="l00586"></a>00586     {
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (m_pBottomPanel) <span class="keywordflow">return</span>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589         <span class="comment">// 下パネルのベース</span>
<a name="l00590"></a>00590         m_pBottomPanel = <span class="keyword">new</span> <a class="code" href="class_wgu_1_1_multi_panel.html" title="Win32 APIの簡易ラッパークラス（マルチパネル）.">Wgu::MultiPanel</a>(
<a name="l00591"></a>00591             GetDlgItem(m_hwndMain, <a class="code" href="resource_8h.html#c6f2cd21ede4a6639d707bbd91d32fd7">IDC_BOTTOM_TAB</a>), <span class="keyword">true</span>);
<a name="l00592"></a>00592         <span class="keywordflow">if</span> (!m_pBottomPanel) <span class="keywordflow">return</span>;
<a name="l00593"></a>00593 
<a name="l00594"></a>00594         <span class="comment">// メッセージパネルを追加</span>
<a name="l00595"></a>00595         <a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html" title="パネルプロシージャクラス（下部パネル：メッセージ）">Wgu::BottomPanelProc_Msg</a> *prMsg = <span class="keyword">new</span> <a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html" title="パネルプロシージャクラス（下部パネル：メッセージ）">Wgu::BottomPanelProc_Msg</a>();
<a name="l00596"></a>00596         prMsg-&gt;<a class="code" href="class_wgu_1_1_base_panel_proc.html#e05f1a58e62beaf4d43d67afd383c691" title="ダイアログプロシージャをセットする">setDlgProc</a>(<a class="code" href="namespace_wgu.html#f715e00864fd44e434b34d5aa66ef0ef">Wgu::PanelWndProc_Bottom_Msg</a>);
<a name="l00597"></a>00597         m_pBottomPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#ab9adf45a86976327c7f09efbe8b7777" title="パネルを追加する">addPanel</a>(<span class="stringliteral">"messages"</span>, <a class="code" href="resource_8h.html#5779867a89898c885f268dcffcef3a90">IDD_BOTTOM_MSG</a>, prMsg, 5, 25);
<a name="l00598"></a>00598 
<a name="l00599"></a>00599         <span class="comment">// 初期状態</span>
<a name="l00600"></a>00600         m_pBottomPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#e920f231d122da567e0c93629f910f64" title="パネルを選択する">selectPanel</a>(BOTTOM_PANEL::BP_MSG);
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603     <span class="keywordtype">void</span> MainWindow::initGuiContents()
<a name="l00604"></a>00604     {
<a name="l00605"></a>00605         <span class="comment">// パネル等の表示内容初期化</span>
<a name="l00606"></a>00606 
<a name="l00607"></a>00607         <span class="comment">// クラスエディタウィンドウ</span>
<a name="l00608"></a>00608         <span class="keywordflow">if</span> (m_pClassEditorWindow)
<a name="l00609"></a>00609         {
<a name="l00610"></a>00610             m_pClassEditorWindow-&gt;<a class="code" href="class_sgv_1_1_class_editor_window.html#4250aea6af2e77b1490d34c91118c3c0" title="このウィンドウ上のGUIコントロールを初期化する">init</a>();
<a name="l00611"></a>00611             m_pClassEditorWindow-&gt;<a class="code" href="class_sgv_1_1_class_editor_window.html#b49ae5d0a200b5680a2b9bc37dcaf87c" title="プレビュー用のX3Dファイル名リストボックスを設定する">setX3DFileList</a>(<span class="keyword">this</span>);
<a name="l00612"></a>00612         }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614         <span class="comment">// 下部パネル</span>
<a name="l00615"></a>00615         <a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html" title="パネルプロシージャクラス（下部パネル：メッセージ）">Wgu::BottomPanelProc_Msg</a> *rpMsg = (<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html" title="パネルプロシージャクラス（下部パネル：メッセージ）">Wgu::BottomPanelProc_Msg</a> *)(<a class="code" href="class_sgv_1_1_main_window.html#3a973b7677c1d4903c5c15026abef4d3" title="メインウィンドウ下のパネルのパネルプロシージャを得る">getBottomPanelProc</a>(BOTTOM_PANEL::BP_MSG));
<a name="l00616"></a>00616         <span class="keywordflow">if</span> (rpMsg) rpMsg-&gt;<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html#d14ff7b30ac4d2eaf5a3dc5a9b0e0f5a" title="コントロールの表示状態の初期化">init</a>(m_bShowTestControls);
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618 
<a name="l00619"></a><a class="code" href="class_sgv_1_1_main_window.html#fd7d10da91726217361b4d0df02e9a31">00619</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#fd7d10da91726217361b4d0df02e9a31" title="カレントディレクトリにあるXMLファイルを検索し、 世界XMLファイル名、エ...">MainWindow::searchXMLFileList</a>()
<a name="l00620"></a>00620     {
<a name="l00621"></a>00621         <span class="keywordflow">if</span> (m_XMLFileList.<a class="code" href="class_sgv_1_1_x_m_l_file_list.html#fc69d27a3aaaeb3cf349f0b9d1669452" title="指定ディレクトリにあるXMLファイルをサーチし、">searchXMLFiles</a>(NULL))
<a name="l00622"></a>00622         {
<a name="l00623"></a>00623             <a class="code" href="class_sgv_1_1_log.html#5e05b61c611e6611bdb22726f826d209" title="ログへ文字列を出力（書式指定可能．改行付き）">Sgv::Log::println</a>(<span class="stringliteral">"*** XML file list ***"</span>);
<a name="l00624"></a>00624             m_XMLFileList.<a class="code" href="class_sgv_1_1_x_m_l_file_list.html#456c5bdc0c274439325bdbd3bf6ce1d2" title="デバッグ用">dump</a>(<a class="code" href="class_sgv_1_1_main_window.html#304ce7f3464567977f16a62a0bb0e3c8" title="ログファイルのファイルポインタを返す">getLogFp</a>());
<a name="l00625"></a>00625 
<a name="l00626"></a>00626             <span class="comment">// クラスファイルロード</span>
<a name="l00627"></a>00627             m_entClassMgr.<a class="code" href="class_sgv_1_1_x_m_l_entity_class_manager.html#3d8988964453a0d898921c60e24c485c" title="XMLファイルリストに列挙されている クラスファイル（複数）をロードする...">loadXMLEntityClassFiles</a>(&amp;m_XMLFileList);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629             <span class="comment">// クラス名表示リストの更新</span>
<a name="l00630"></a>00630             <span class="comment">// クラスエディタウィンドウ</span>
<a name="l00631"></a>00631             <span class="keywordflow">if</span> (m_pClassEditorWindow)
<a name="l00632"></a>00632             {
<a name="l00633"></a>00633                 m_pClassEditorWindow-&gt;<a class="code" href="class_sgv_1_1_class_editor_window.html#163b9fae3c0366f6ca4fc208a10447a0" title="クラス名一覧をリストボックスに設定する">setClassList</a>(<span class="keyword">this</span>);
<a name="l00634"></a>00634             }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636             <span class="comment">// エンティティパネル</span>
<a name="l00637"></a>00637             <a class="code" href="class_wgu_1_1_right_panel_proc___entity.html" title="パネルプロシージャクラス（右パネル：エンティティ）">Wgu::RightPanelProc_Entity</a> *rpEnt = (<a class="code" href="class_wgu_1_1_right_panel_proc___entity.html" title="パネルプロシージャクラス（右パネル：エンティティ）">Wgu::RightPanelProc_Entity</a> *)(<a class="code" href="class_sgv_1_1_main_window.html#7c26a938ac8f241d743c89cce327c950" title="メインウィンドウ右のパネルのパネルプロシージャを得る">getRightPanelProc</a>(RIGHT_PANEL::RP_ENTITY));
<a name="l00638"></a>00638             <span class="keywordflow">if</span> (rpEnt) rpEnt-&gt;<a class="code" href="class_wgu_1_1_right_panel_proc___entity.html#4aa3519118eb969a55b9387219c35788" title="クラス名一覧リストボックスの内容をセットする （EntityとAgentクラスは除...">setClassList</a>(<span class="keyword">this</span>);
<a name="l00639"></a>00639         }
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641 
<a name="l00642"></a><a class="code" href="class_sgv_1_1_main_window.html#f68b13945d869c00ce21576f203e3afc">00642</a>     <span class="keywordtype">int</span> <a class="code" href="class_sgv_1_1_main_window.html#f68b13945d869c00ce21576f203e3afc" title="レンダーウィンドウの幅を得る">MainWindow::getRenderWindowWidth</a>()
<a name="l00643"></a>00643     {
<a name="l00644"></a>00644         <span class="keywordflow">return</span> (m_pRenderWindow) ? m_pRenderWindow-&gt;getWidth() : 0;
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646 
<a name="l00647"></a><a class="code" href="class_sgv_1_1_main_window.html#8e20f5bd705a326548dd8850bdd64189">00647</a>     <span class="keywordtype">int</span> <a class="code" href="class_sgv_1_1_main_window.html#8e20f5bd705a326548dd8850bdd64189" title="レンダーウィンドウの高さを得る">MainWindow::getRenderWindowHeight</a>()
<a name="l00648"></a>00648     {
<a name="l00649"></a>00649         <span class="keywordflow">return</span> (m_pRenderWindow) ? m_pRenderWindow-&gt;getHeight() : 0;
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651 
<a name="l00652"></a><a class="code" href="class_sgv_1_1_main_window.html#0ed03549f9c9959ad30044eab57faf5b">00652</a>     HWND <a class="code" href="class_sgv_1_1_main_window.html#0ed03549f9c9959ad30044eab57faf5b" title="メインウィンドウ右のパネルのウィンドウハンドルを得る">MainWindow::getRightPanelHWND</a>(<span class="keywordtype">int</span> iTab)
<a name="l00653"></a>00653     {
<a name="l00654"></a>00654         <span class="keywordflow">return</span> (m_pRightPanel) ? m_pRightPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#5a3c8894227d6ee10572eac2f0deb550" title="指定パネルのウィンドウハンドルの取得">getPanelHWND</a>(iTab) : NULL;
<a name="l00655"></a>00655     }
<a name="l00656"></a>00656 
<a name="l00657"></a><a class="code" href="class_sgv_1_1_main_window.html#621cfd3a9a6fc2de5ce9a09a5150f2a3">00657</a>     HWND <a class="code" href="class_sgv_1_1_main_window.html#621cfd3a9a6fc2de5ce9a09a5150f2a3" title="メインウィンドウ下のパネルのウィンドウハンドルを得る">MainWindow::getBottomPanelHWND</a>(<span class="keywordtype">int</span> iTab)
<a name="l00658"></a>00658     {
<a name="l00659"></a>00659         <span class="keywordflow">return</span> (m_pBottomPanel) ? m_pBottomPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#5a3c8894227d6ee10572eac2f0deb550" title="指定パネルのウィンドウハンドルの取得">getPanelHWND</a>(iTab) : NULL;
<a name="l00660"></a>00660     }
<a name="l00661"></a>00661 
<a name="l00662"></a><a class="code" href="class_sgv_1_1_main_window.html#7c26a938ac8f241d743c89cce327c950">00662</a>     <a class="code" href="class_wgu_1_1_base_panel_proc.html" title="パネルプロシージャベースクラス">Wgu::BasePanelProc</a> *<a class="code" href="class_sgv_1_1_main_window.html#7c26a938ac8f241d743c89cce327c950" title="メインウィンドウ右のパネルのパネルプロシージャを得る">MainWindow::getRightPanelProc</a>(<span class="keywordtype">int</span> iTab)
<a name="l00663"></a>00663     {
<a name="l00664"></a>00664         <span class="keywordflow">return</span> (m_pRightPanel) ? m_pRightPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#d8795521f61c7e939e568cd46545697e" title="指定パネルのパネルプロシージャオブジェクトの取得">getPanelProc</a>(iTab) : NULL;
<a name="l00665"></a>00665     }
<a name="l00666"></a>00666 
<a name="l00667"></a><a class="code" href="class_sgv_1_1_main_window.html#3a973b7677c1d4903c5c15026abef4d3">00667</a>     <a class="code" href="class_wgu_1_1_base_panel_proc.html" title="パネルプロシージャベースクラス">Wgu::BasePanelProc</a> *<a class="code" href="class_sgv_1_1_main_window.html#3a973b7677c1d4903c5c15026abef4d3" title="メインウィンドウ下のパネルのパネルプロシージャを得る">MainWindow::getBottomPanelProc</a>(<span class="keywordtype">int</span> iTab)
<a name="l00668"></a>00668     {
<a name="l00669"></a>00669         <span class="keywordflow">return</span> (m_pBottomPanel) ? m_pBottomPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#d8795521f61c7e939e568cd46545697e" title="指定パネルのパネルプロシージャオブジェクトの取得">getPanelProc</a>(iTab) : NULL;
<a name="l00670"></a>00670     }
<a name="l00671"></a>00671 
<a name="l00672"></a><a class="code" href="class_sgv_1_1_main_window.html#ed91e2335b1d1d977fc3b28d96698c17">00672</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#ed91e2335b1d1d977fc3b28d96698c17" title="世界をクリアする">MainWindow::clearWorld</a>()
<a name="l00673"></a>00673     {
<a name="l00674"></a>00674         <span class="comment">// 全エンティティ名でループ</span>
<a name="l00675"></a>00675         std::vector&lt;std::string&gt; entNames = m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#281cf75a5d953d8f6f41cf94f6ef6366" title="世界内に存在するエンティティ名のリストを返す">getEntityNames</a>();
<a name="l00676"></a>00676         <span class="keywordtype">int</span> n = entNames.size();
<a name="l00677"></a>00677         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n; i++)
<a name="l00678"></a>00678         {
<a name="l00679"></a>00679             <span class="keyword">const</span> <span class="keywordtype">char</span> *entName = entNames[i].c_str();
<a name="l00680"></a>00680 
<a name="l00681"></a>00681             <span class="comment">// 消す</span>
<a name="l00682"></a>00682             <a class="code" href="class_sgv_1_1_main_window.html#78b08b8b5fecc75b6dab54aa65e43a08" title="エンティティを削除する">deleteEntity</a>(entName);
<a name="l00683"></a>00683         }
<a name="l00684"></a>00684 
<a name="l00685"></a>00685         m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#9f6ae1b72db24ec2616bcc5c52ec203a" title="すべてクリアする">clear</a>();
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687 
<a name="l00688"></a><a class="code" href="class_sgv_1_1_main_window.html#009b6166b28db8f52fded780c57a2889">00688</a>     <span class="keywordtype">bool</span> <a class="code" href="class_sgv_1_1_main_window.html#009b6166b28db8f52fded780c57a2889" title="世界XMLファイルのロード">MainWindow::loadWorldXMLFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *worldXMLFile)
<a name="l00689"></a>00689     {
<a name="l00690"></a>00690         <span class="keywordtype">char</span> buf[1024];
<a name="l00691"></a>00691 
<a name="l00692"></a>00692         <span class="comment">// 右パネル（エンティティ）を得る</span>
<a name="l00693"></a>00693         <a class="code" href="class_wgu_1_1_right_panel_proc___entity.html" title="パネルプロシージャクラス（右パネル：エンティティ）">Wgu::RightPanelProc_Entity</a> *rpEnt = (<a class="code" href="class_wgu_1_1_right_panel_proc___entity.html" title="パネルプロシージャクラス（右パネル：エンティティ）">Wgu::RightPanelProc_Entity</a> *)(<a class="code" href="class_sgv_1_1_main_window.html#7c26a938ac8f241d743c89cce327c950" title="メインウィンドウ右のパネルのパネルプロシージャを得る">getRightPanelProc</a>(RIGHT_PANEL::RP_ENTITY));
<a name="l00694"></a>00694 
<a name="l00695"></a>00695         <span class="comment">// 下パネルのパネルプロシージャを得る</span>
<a name="l00696"></a>00696         <a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html" title="パネルプロシージャクラス（下部パネル：メッセージ）">Wgu::BottomPanelProc_Msg</a> *bpMsg = (<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html" title="パネルプロシージャクラス（下部パネル：メッセージ）">Wgu::BottomPanelProc_Msg</a> *)(<a class="code" href="class_sgv_1_1_main_window.html#3a973b7677c1d4903c5c15026abef4d3" title="メインウィンドウ下のパネルのパネルプロシージャを得る">getBottomPanelProc</a>(BOTTOM_PANEL::BP_MSG));
<a name="l00697"></a>00697 
<a name="l00698"></a>00698         <span class="comment">// 既存の世界を消す</span>
<a name="l00699"></a>00699         <a class="code" href="class_sgv_1_1_main_window.html#ed91e2335b1d1d977fc3b28d96698c17" title="世界をクリアする">clearWorld</a>();
<a name="l00700"></a>00700 
<a name="l00701"></a>00701         <span class="comment">// 世界XMLファイルを読み込む</span>
<a name="l00702"></a>00702         std::vector&lt;std::string&gt; missingClassFiles;
<a name="l00703"></a>00703         <span class="keywordtype">int</span> err = m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#f53f2007d0a49adfafcd69eadcc5ae87" title="世界XMLファイルを読み込む">loadFromXML</a>(worldXMLFile, missingClassFiles);
<a name="l00704"></a>00704         <span class="keywordflow">switch</span> (err)
<a name="l00705"></a>00705         {
<a name="l00706"></a>00706         <span class="keywordflow">case</span> -1:
<a name="l00707"></a>00707             {
<a name="l00708"></a>00708                 <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(<span class="stringliteral">"cannot load (%s)¥n"</span>, worldXMLFile);
<a name="l00709"></a>00709                 sprintf(buf, <span class="stringliteral">"%sの読み込みに失敗しました．"</span>, worldXMLFile);
<a name="l00710"></a>00710                 MessageBox(NULL, buf, <span class="stringliteral">"error"</span>, MB_OK | MB_ICONEXCLAMATION);
<a name="l00711"></a>00711                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00712"></a>00712             }
<a name="l00713"></a>00713         <span class="keywordflow">case</span> -2:
<a name="l00714"></a>00714             {
<a name="l00715"></a>00715                 <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(<span class="stringliteral">"(%s) is not SIGVerse world file.¥n"</span>, worldXMLFile);
<a name="l00716"></a>00716                 sprintf(buf, <span class="stringliteral">"%s は世界ファイルではありません．"</span>, worldXMLFile);
<a name="l00717"></a>00717                 MessageBox(NULL, buf, <span class="stringliteral">"error"</span>, MB_OK | MB_ICONEXCLAMATION);
<a name="l00718"></a>00718                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00719"></a>00719             }
<a name="l00720"></a>00720         <span class="keywordflow">case</span> -3:
<a name="l00721"></a>00721             {
<a name="l00722"></a>00722                 <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(<span class="stringliteral">"Internal error: cannot load (%s)¥n"</span>, worldXMLFile);
<a name="l00723"></a>00723                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00724"></a>00724             }
<a name="l00725"></a>00725         <span class="keywordflow">case</span> -4:
<a name="l00726"></a>00726             {
<a name="l00727"></a>00727                 <span class="keywordtype">char</span> errmsg[1024];
<a name="l00728"></a>00728                 <span class="keywordtype">int</span> n = missingClassFiles.size();
<a name="l00729"></a>00729 
<a name="l00730"></a>00730                 sprintf(errmsg, <span class="stringliteral">"(%s) contains following %d invalid class references:¥n"</span>, worldXMLFile, n);
<a name="l00731"></a>00731                 <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(errmsg);
<a name="l00732"></a>00732                 <a class="code" href="class_sgv_1_1_log.html#93dcad7dd4a6aa975f0430ed44851f59" title="ログへエラーメッセージを出力（書式指定可能．改行なし）...">Log::error</a>(errmsg);
<a name="l00733"></a>00733                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n; i++)
<a name="l00734"></a>00734                 {
<a name="l00735"></a>00735                     <span class="keyword">const</span> <span class="keywordtype">char</span> *missingClassFile = missingClassFiles[i].c_str();
<a name="l00736"></a>00736 
<a name="l00737"></a>00737                     sprintf(errmsg, <span class="stringliteral">"[%d] (%s) -- not found.¥n"</span>, i, missingClassFile);
<a name="l00738"></a>00738                     <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(errmsg);
<a name="l00739"></a>00739                     <a class="code" href="class_sgv_1_1_log.html#93dcad7dd4a6aa975f0430ed44851f59" title="ログへエラーメッセージを出力（書式指定可能．改行なし）...">Log::error</a>(errmsg);
<a name="l00740"></a>00740                 }
<a name="l00741"></a>00741             }
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744         <span class="comment">// エンティティ名コンボボックスをクリア</span>
<a name="l00745"></a>00745         <span class="keywordflow">if</span> (rpEnt) rpEnt-&gt;<a class="code" href="class_wgu_1_1_right_panel_proc___entity.html#b6432c547320b84e16d18205cc9de319" title="エンティティ名選択コンボボックスをクリアする">clearEntityNameSelector</a>();
<a name="l00746"></a>00746 
<a name="l00747"></a>00747         <span class="comment">// 世界名を下パネルに表示</span>
<a name="l00748"></a>00748         <span class="keywordflow">if</span> (bpMsg) bpMsg-&gt;<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html#709941808c9e56814179bfabc73fce18" title="世界名をエディットコントロールにセットする">setWorldName</a>(m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#00225b921c4421883527beef89f6f020" title="世界名を返す">getWorldName</a>());
<a name="l00749"></a>00749 
<a name="l00750"></a>00750         <span class="comment">// 世界XMLファイルに含まれるエンティティ名のリストを得る</span>
<a name="l00751"></a>00751         std::vector&lt;std::string&gt; entNames = m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#281cf75a5d953d8f6f41cf94f6ef6366" title="世界内に存在するエンティティ名のリストを返す">getEntityNames</a>();
<a name="l00752"></a>00752 
<a name="l00753"></a>00753         <span class="comment">// 砂時計カーソルに変える</span>
<a name="l00754"></a>00754         <a class="code" href="class_sgv_1_1_main_window.html#1dc2e5cf847eed2f331656cd076680f3" title="マウスカーソルの形状を設定する">showWaitCursor</a>(<span class="keyword">true</span>);
<a name="l00755"></a>00755         <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(<span class="stringliteral">"loading %s ... "</span>, worldXMLFile);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757         <span class="keywordtype">int</span> n = entNames.size();
<a name="l00758"></a>00758         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n; i++)
<a name="l00759"></a>00759         {
<a name="l00760"></a>00760             std::string entName = entNames[i];
<a name="l00761"></a>00761 
<a name="l00762"></a>00762             <span class="comment">// XMLエンティティからOgreノードを生成</span>
<a name="l00763"></a>00763             SceneNode *node = <a class="code" href="class_sgv_1_1_main_window.html#1efe71d8255792ddc8d25ccc65238a19" title="XMLエンティティからOgreシーンノードを作る．.">createEntityNode</a>(entName.c_str());
<a name="l00764"></a>00764             <span class="keywordflow">if</span> (node)
<a name="l00765"></a>00765             {
<a name="l00766"></a>00766                 <span class="comment">// 位置、回転設定</span>
<a name="l00767"></a>00767                 <a class="code" href="class_sgv_1_1_main_window.html#4a273df556961eee252f60998f51cdcc" title="OgreノードをXMLエンティティで更新.">updateNodeWithEntity</a>(entName.c_str());
<a name="l00768"></a>00768 
<a name="l00769"></a>00769                 <span class="comment">// エンティティ名コンボボックスに名前追加</span>
<a name="l00770"></a>00770                 <span class="keywordflow">if</span> (rpEnt) rpEnt-&gt;<a class="code" href="class_wgu_1_1_right_panel_proc___entity.html#a5326532c49357b993214f6ba5697692" title="エンティティ名選択コンボボックスに新しいエンティティ名を追...">addNewEntityNameToEntityNameSelector</a>(entName.c_str());
<a name="l00771"></a>00771             }
<a name="l00772"></a>00772             <span class="keywordflow">else</span>
<a name="l00773"></a>00773             {
<a name="l00774"></a>00774                 <span class="comment">// 形状作成に失敗．ロードしたエンティティを消す</span>
<a name="l00775"></a>00775                 m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#2245358f7cf4c9e23c7417bdbb429384" title="XMLEntityを削除する.">deleteEntity</a>(entName.c_str());
<a name="l00776"></a>00776             }
<a name="l00777"></a>00777         }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779         <span class="comment">// 元のカーソルに戻す</span>
<a name="l00780"></a>00780         <a class="code" href="class_sgv_1_1_main_window.html#1dc2e5cf847eed2f331656cd076680f3" title="マウスカーソルの形状を設定する">showWaitCursor</a>(<span class="keyword">false</span>);
<a name="l00781"></a>00781         <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(<span class="stringliteral">"done.¥r¥n"</span>);
<a name="l00782"></a>00782 
<a name="l00783"></a>00783         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00784"></a>00784     }
<a name="l00785"></a>00785 
<a name="l00786"></a><a class="code" href="class_sgv_1_1_main_window.html#2d0223dc4f576579b8ddb2d30e00769b">00786</a>     <span class="keywordtype">bool</span> <a class="code" href="class_sgv_1_1_main_window.html#2d0223dc4f576579b8ddb2d30e00769b" title="世界XMLファイルへのセーブ">MainWindow::saveWorldXMLFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *worldXMLFile)
<a name="l00787"></a>00787     {
<a name="l00788"></a>00788         <span class="comment">// 下パネルのパネルプロシージャを得る</span>
<a name="l00789"></a>00789         <a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html" title="パネルプロシージャクラス（下部パネル：メッセージ）">Wgu::BottomPanelProc_Msg</a> *bpMsg = (<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html" title="パネルプロシージャクラス（下部パネル：メッセージ）">Wgu::BottomPanelProc_Msg</a> *)(<a class="code" href="class_sgv_1_1_main_window.html#3a973b7677c1d4903c5c15026abef4d3" title="メインウィンドウ下のパネルのパネルプロシージャを得る">getBottomPanelProc</a>(BOTTOM_PANEL::BP_MSG));
<a name="l00790"></a>00790 
<a name="l00791"></a>00791         <span class="comment">// 世界名を得る</span>
<a name="l00792"></a>00792         std::string worldName = <span class="stringliteral">""</span>;
<a name="l00793"></a>00793         <span class="keywordflow">if</span> (bpMsg) worldName = bpMsg-&gt;<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html#43493a3ba1b07dffa3459e1811de48f1" title="世界名をエディットコントロールから取得する">getWorldName</a>();
<a name="l00794"></a>00794 
<a name="l00795"></a>00795         <span class="comment">// 世界名をセット</span>
<a name="l00796"></a>00796         m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#79efc792e448daba3e42b2da656fdc81" title="世界名をセットする">setWorldName</a>(worldName.c_str());
<a name="l00797"></a>00797 
<a name="l00798"></a>00798         <span class="comment">// 砂時計カーソルに変える</span>
<a name="l00799"></a>00799         <a class="code" href="class_sgv_1_1_main_window.html#1dc2e5cf847eed2f331656cd076680f3" title="マウスカーソルの形状を設定する">showWaitCursor</a>(<span class="keyword">true</span>);
<a name="l00800"></a>00800         <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(<span class="stringliteral">"saving %s ... "</span>, worldXMLFile);
<a name="l00801"></a>00801 
<a name="l00802"></a>00802         <span class="comment">// セーブ</span>
<a name="l00803"></a>00803         <span class="keywordtype">bool</span> bSucceeded = m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#5e619944c7b430f620e839b8fd5ac71f" title="世界XMLファイルを書き出す">saveToXML</a>(worldXMLFile);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805         <span class="comment">// 元のカーソルに戻す</span>
<a name="l00806"></a>00806         <a class="code" href="class_sgv_1_1_main_window.html#1dc2e5cf847eed2f331656cd076680f3" title="マウスカーソルの形状を設定する">showWaitCursor</a>(<span class="keyword">false</span>);
<a name="l00807"></a>00807         <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(<span class="stringliteral">"done.¥r¥n"</span>);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809         <span class="keywordflow">return</span> bSucceeded;
<a name="l00810"></a>00810     }
<a name="l00811"></a>00811 
<a name="l00812"></a><a class="code" href="class_sgv_1_1_main_window.html#dcf92c7faee2025be3b6e480642e7a83">00812</a>     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="class_sgv_1_1_main_window.html#dcf92c7faee2025be3b6e480642e7a83" title="現在編集中の世界XMLファイル名を返す 最後にロードまたはセーブしたファ...">MainWindow::getWorldFileName</a>()
<a name="l00813"></a>00813     {
<a name="l00814"></a>00814         <span class="keywordflow">return</span> m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#71319626da0ba6e3cdc137c438e0cff6" title="現在編集中の世界のXMLファイル名を返す 最後にロードまたはセーブしたフ...">getWorldFileName</a>();
<a name="l00815"></a>00815     }
<a name="l00816"></a>00816 
<a name="l00817"></a><a class="code" href="class_sgv_1_1_main_window.html#8bdee739a3dcea96be64ab5791afc122">00817</a>     <a class="code" href="class_sgv_1_1_x_m_l_entity.html" title="XMLエンティティ.">XMLEntity</a> *<a class="code" href="class_sgv_1_1_main_window.html#8bdee739a3dcea96be64ab5791afc122" title="エンティティ名からXMLEntityを引く">MainWindow::getEntity</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *entName)
<a name="l00818"></a>00818     {
<a name="l00819"></a>00819         <span class="keywordflow">return</span> m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#562a9f9eb5683ef823c7a5a9031b856c" title="エンティティ名からXMLEntityを引く">getEntity</a>(entName);
<a name="l00820"></a>00820     }
<a name="l00821"></a>00821 
<a name="l00822"></a><a class="code" href="class_sgv_1_1_main_window.html#fa8ef5695a4c2a3bfcf93cf1e0d9a08f">00822</a>     SceneNode *<a class="code" href="class_sgv_1_1_main_window.html#fa8ef5695a4c2a3bfcf93cf1e0d9a08f" title="エンティティ名からOgreノードを引く． 見つからないときはNULLが返る...">MainWindow::getEntityNode</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *entName)
<a name="l00823"></a>00823     {
<a name="l00824"></a>00824         <span class="keywordflow">if</span> (!entName) <span class="keywordflow">return</span> NULL;
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         std::map&lt;std::string, SceneNode *&gt;::iterator i = m_mapEntNameToShapeNode.find(entName);
<a name="l00827"></a>00827         <span class="keywordflow">if</span> (i != m_mapEntNameToShapeNode.end())
<a name="l00828"></a>00828         {
<a name="l00829"></a>00829             <span class="comment">// 発見</span>
<a name="l00830"></a>00830             <span class="keywordflow">return</span> i-&gt;second;
<a name="l00831"></a>00831         }
<a name="l00832"></a>00832         <span class="keywordflow">else</span>
<a name="l00833"></a>00833         {
<a name="l00834"></a>00834             <span class="comment">// 見つからなかった</span>
<a name="l00835"></a>00835             <span class="keywordflow">return</span> NULL;
<a name="l00836"></a>00836         }
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838 
<a name="l00839"></a><a class="code" href="class_sgv_1_1_main_window.html#9349a668ce565c540a171af8f48278c0">00839</a>     <a class="code" href="class_sgv_1_1_humanoid_node_map.html" title="ヒューマノイド形状における、ジョイント名、パーツ名と それらに対応す...">HumanoidNodeMap</a> *<a class="code" href="class_sgv_1_1_main_window.html#9349a668ce565c540a171af8f48278c0" title="エンティティ名からHumanoidNodeMapを引く． エンティティがヒューマノイドで...">MainWindow::getHumanoidNodeMap</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *entName)
<a name="l00840"></a>00840     {
<a name="l00841"></a>00841         <span class="keywordflow">if</span> (!entName) <span class="keywordflow">return</span> NULL;
<a name="l00842"></a>00842 
<a name="l00843"></a>00843         std::map&lt;std::string, HumanoidNodeMap *&gt;::iterator i = m_mapEntNameToHumanoidNodeMap.find(entName);
<a name="l00844"></a>00844         <span class="keywordflow">if</span> (i != m_mapEntNameToHumanoidNodeMap.end())
<a name="l00845"></a>00845         {
<a name="l00846"></a>00846             <span class="comment">// 発見</span>
<a name="l00847"></a>00847             <span class="keywordflow">return</span> i-&gt;second;
<a name="l00848"></a>00848         }
<a name="l00849"></a>00849         <span class="keywordflow">else</span>
<a name="l00850"></a>00850         {
<a name="l00851"></a>00851             <span class="comment">// 見つからなかった</span>
<a name="l00852"></a>00852             <span class="keywordflow">return</span> NULL;
<a name="l00853"></a>00853         }
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855 
<a name="l00856"></a><a class="code" href="class_sgv_1_1_main_window.html#19791b7d758cb6105a798404f0cfb2f6">00856</a>     <span class="keywordtype">bool</span> <a class="code" href="class_sgv_1_1_main_window.html#19791b7d758cb6105a798404f0cfb2f6" title="XMLエンティティをOgreノードで更新.">MainWindow::updateEntityWithNode</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *entName)
<a name="l00857"></a>00857     {
<a name="l00858"></a>00858         <a class="code" href="class_sgv_1_1_x_m_l_entity.html" title="XMLエンティティ.">XMLEntity</a> *ent = <a class="code" href="class_sgv_1_1_main_window.html#8bdee739a3dcea96be64ab5791afc122" title="エンティティ名からXMLEntityを引く">getEntity</a>(entName);
<a name="l00859"></a>00859         SceneNode *node = <a class="code" href="class_sgv_1_1_main_window.html#fa8ef5695a4c2a3bfcf93cf1e0d9a08f" title="エンティティ名からOgreノードを引く． 見つからないときはNULLが返る...">getEntityNode</a>(entName);
<a name="l00860"></a>00860         <span class="keywordflow">if</span> (ent &amp;&amp; node)
<a name="l00861"></a>00861         {
<a name="l00862"></a>00862             Vector3 pos = node-&gt;getPosition();
<a name="l00863"></a>00863             Quaternion q = node-&gt;getOrientation();
<a name="l00864"></a>00864             Vector3 scale = node-&gt;getScale();
<a name="l00865"></a>00865 
<a name="l00866"></a>00866             ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#812f880e018195c021b43fe3d5771e7e" title="属性値を実数で設定する．">setAttrValueDouble</a>(<span class="stringliteral">"x"</span>, pos.x);
<a name="l00867"></a>00867             ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#812f880e018195c021b43fe3d5771e7e" title="属性値を実数で設定する．">setAttrValueDouble</a>(<span class="stringliteral">"y"</span>, pos.y);
<a name="l00868"></a>00868             ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#812f880e018195c021b43fe3d5771e7e" title="属性値を実数で設定する．">setAttrValueDouble</a>(<span class="stringliteral">"z"</span>, pos.z);
<a name="l00869"></a>00869 
<a name="l00870"></a>00870             ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#812f880e018195c021b43fe3d5771e7e" title="属性値を実数で設定する．">setAttrValueDouble</a>(<span class="stringliteral">"qw"</span>, q.w);
<a name="l00871"></a>00871             ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#812f880e018195c021b43fe3d5771e7e" title="属性値を実数で設定する．">setAttrValueDouble</a>(<span class="stringliteral">"qx"</span>, q.x);
<a name="l00872"></a>00872             ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#812f880e018195c021b43fe3d5771e7e" title="属性値を実数で設定する．">setAttrValueDouble</a>(<span class="stringliteral">"qy"</span>, q.y);
<a name="l00873"></a>00873             ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#812f880e018195c021b43fe3d5771e7e" title="属性値を実数で設定する．">setAttrValueDouble</a>(<span class="stringliteral">"qz"</span>, q.z);
<a name="l00874"></a>00874 
<a name="l00875"></a>00875             ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#812f880e018195c021b43fe3d5771e7e" title="属性値を実数で設定する．">setAttrValueDouble</a>(<span class="stringliteral">"scalex"</span>, scale.x);
<a name="l00876"></a>00876             ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#812f880e018195c021b43fe3d5771e7e" title="属性値を実数で設定する．">setAttrValueDouble</a>(<span class="stringliteral">"scaley"</span>, scale.y);
<a name="l00877"></a>00877             ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#812f880e018195c021b43fe3d5771e7e" title="属性値を実数で設定する．">setAttrValueDouble</a>(<span class="stringliteral">"scalez"</span>, scale.z);
<a name="l00878"></a>00878 
<a name="l00879"></a>00879             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00880"></a>00880         }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00883"></a>00883     }
<a name="l00884"></a>00884 
<a name="l00885"></a><a class="code" href="class_sgv_1_1_main_window.html#4a273df556961eee252f60998f51cdcc">00885</a>     <span class="keywordtype">bool</span> <a class="code" href="class_sgv_1_1_main_window.html#4a273df556961eee252f60998f51cdcc" title="OgreノードをXMLエンティティで更新.">MainWindow::updateNodeWithEntity</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *entName)
<a name="l00886"></a>00886     {
<a name="l00887"></a>00887         <a class="code" href="class_sgv_1_1_x_m_l_entity.html" title="XMLエンティティ.">XMLEntity</a> *ent = <a class="code" href="class_sgv_1_1_main_window.html#8bdee739a3dcea96be64ab5791afc122" title="エンティティ名からXMLEntityを引く">getEntity</a>(entName);
<a name="l00888"></a>00888         SceneNode *node = <a class="code" href="class_sgv_1_1_main_window.html#fa8ef5695a4c2a3bfcf93cf1e0d9a08f" title="エンティティ名からOgreノードを引く． 見つからないときはNULLが返る...">getEntityNode</a>(entName);
<a name="l00889"></a>00889         <span class="keywordflow">if</span> (ent &amp;&amp; node)
<a name="l00890"></a>00890         {
<a name="l00891"></a>00891             Vector3 pos, scale;
<a name="l00892"></a>00892             Quaternion q;
<a name="l00893"></a>00893 
<a name="l00894"></a>00894             pos.x = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#27d54507b0b7e65dd5dafaddf3a8ea1b" title="属性値(set-attr-valueタグ)を実数で返す">getAttrValueDouble</a>(<span class="stringliteral">"x"</span>, 0);
<a name="l00895"></a>00895             pos.y = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#27d54507b0b7e65dd5dafaddf3a8ea1b" title="属性値(set-attr-valueタグ)を実数で返す">getAttrValueDouble</a>(<span class="stringliteral">"y"</span>, 0);
<a name="l00896"></a>00896             pos.z = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#27d54507b0b7e65dd5dafaddf3a8ea1b" title="属性値(set-attr-valueタグ)を実数で返す">getAttrValueDouble</a>(<span class="stringliteral">"z"</span>, 0);
<a name="l00897"></a>00897 
<a name="l00898"></a>00898             q.w = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#27d54507b0b7e65dd5dafaddf3a8ea1b" title="属性値(set-attr-valueタグ)を実数で返す">getAttrValueDouble</a>(<span class="stringliteral">"qw"</span>, 1);
<a name="l00899"></a>00899             q.x = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#27d54507b0b7e65dd5dafaddf3a8ea1b" title="属性値(set-attr-valueタグ)を実数で返す">getAttrValueDouble</a>(<span class="stringliteral">"qx"</span>, 0);
<a name="l00900"></a>00900             q.y = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#27d54507b0b7e65dd5dafaddf3a8ea1b" title="属性値(set-attr-valueタグ)を実数で返す">getAttrValueDouble</a>(<span class="stringliteral">"qy"</span>, 0);
<a name="l00901"></a>00901             q.z = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#27d54507b0b7e65dd5dafaddf3a8ea1b" title="属性値(set-attr-valueタグ)を実数で返す">getAttrValueDouble</a>(<span class="stringliteral">"qz"</span>, 0);
<a name="l00902"></a>00902 
<a name="l00903"></a>00903             scale.x = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#27d54507b0b7e65dd5dafaddf3a8ea1b" title="属性値(set-attr-valueタグ)を実数で返す">getAttrValueDouble</a>(<span class="stringliteral">"scalex"</span>, 1);
<a name="l00904"></a>00904             scale.y = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#27d54507b0b7e65dd5dafaddf3a8ea1b" title="属性値(set-attr-valueタグ)を実数で返す">getAttrValueDouble</a>(<span class="stringliteral">"scaley"</span>, 1);
<a name="l00905"></a>00905             scale.z = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#27d54507b0b7e65dd5dafaddf3a8ea1b" title="属性値(set-attr-valueタグ)を実数で返す">getAttrValueDouble</a>(<span class="stringliteral">"scalez"</span>, 1);
<a name="l00906"></a>00906 
<a name="l00907"></a>00907             node-&gt;setPosition(pos);
<a name="l00908"></a>00908             node-&gt;setOrientation(q);
<a name="l00909"></a>00909             node-&gt;setScale(scale);
<a name="l00910"></a>00910 
<a name="l00911"></a>00911             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00912"></a>00912         }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00915"></a>00915     }
<a name="l00916"></a>00916 
<a name="l00917"></a><a class="code" href="class_sgv_1_1_main_window.html#1efe71d8255792ddc8d25ccc65238a19">00917</a>     SceneNode *<a class="code" href="class_sgv_1_1_main_window.html#1efe71d8255792ddc8d25ccc65238a19" title="XMLエンティティからOgreシーンノードを作る．.">MainWindow::createEntityNode</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *entName)
<a name="l00918"></a>00918     {
<a name="l00919"></a>00919         <span class="keywordtype">char</span> msg[1024];
<a name="l00920"></a>00920 
<a name="l00921"></a>00921         <span class="keywordflow">if</span> (!m_pX3D)
<a name="l00922"></a>00922         {
<a name="l00923"></a>00923             <a class="code" href="class_sgv_1_1_log.html#93dcad7dd4a6aa975f0430ed44851f59" title="ログへエラーメッセージを出力（書式指定可能．改行なし）...">Log::error</a>(<span class="stringliteral">"no X3D object¥n"</span>);
<a name="l00924"></a>00924             <span class="keywordflow">return</span> NULL;
<a name="l00925"></a>00925         }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927         <a class="code" href="class_sgv_1_1_x_m_l_entity.html" title="XMLエンティティ.">XMLEntity</a> *ent = m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#562a9f9eb5683ef823c7a5a9031b856c" title="エンティティ名からXMLEntityを引く">getEntity</a>(entName);
<a name="l00928"></a>00928         <span class="keywordflow">if</span> (!ent) <span class="keywordflow">return</span> NULL;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930         <span class="comment">// クラス名を得る</span>
<a name="l00931"></a>00931         <span class="keyword">const</span> <span class="keywordtype">char</span> *className = ent-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity.html#b2de258903ed4fd1addacf5ebc96dbe1" title="このエンティティのクラス名を返す">getClassName</a>();
<a name="l00932"></a>00932         <span class="keywordflow">if</span> (!className)
<a name="l00933"></a>00933         {
<a name="l00934"></a>00934             <a class="code" href="class_sgv_1_1_log.html#93dcad7dd4a6aa975f0430ed44851f59" title="ログへエラーメッセージを出力（書式指定可能．改行なし）...">Log::error</a>(<span class="stringliteral">"cannot get className of entity (%s)¥n"</span>, entName);
<a name="l00935"></a>00935             <span class="keywordflow">return</span> NULL;
<a name="l00936"></a>00936         }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938         <span class="comment">// クラスを得る</span>
<a name="l00939"></a>00939         <a class="code" href="class_sgv_1_1_x_m_l_entity_class.html" title="XMLエンティティクラス（エンティティの定義）.">XMLEntityClass</a> *pc = m_entClassMgr.<a class="code" href="class_sgv_1_1_x_m_l_entity_class_manager.html#0e39a9e56a1eac6fae3573eff19fd758" title="クラス名からXMLEntityClassを引く">getEntityClass</a>(className);
<a name="l00940"></a>00940         <span class="keywordflow">if</span> (!pc)
<a name="l00941"></a>00941         {
<a name="l00942"></a>00942             <a class="code" href="class_sgv_1_1_log.html#93dcad7dd4a6aa975f0430ed44851f59" title="ログへエラーメッセージを出力（書式指定可能．改行なし）...">Log::error</a>(<span class="stringliteral">"cannot get class object of (%s)¥n"</span>, className);
<a name="l00943"></a>00943             <span class="keywordflow">return</span> NULL;
<a name="l00944"></a>00944         }
<a name="l00945"></a>00945 
<a name="l00946"></a>00946         <span class="comment">// X3Dファイル名を得る</span>
<a name="l00947"></a>00947         <span class="keyword">const</span> <span class="keywordtype">char</span> *x3dFileName =pc-&gt;<a class="code" href="class_sgv_1_1_x_m_l_entity_class.html#d5a50e073968522f19f7eba629ba2370" title="i番目の形状ファイル名(X3Dファイル名）を返す">getX3DFileName</a>();
<a name="l00948"></a>00948         <span class="keywordflow">if</span> ((!x3dFileName) || (!*x3dFileName))
<a name="l00949"></a>00949         {
<a name="l00950"></a>00950             sprintf(msg, <span class="stringliteral">"no shape file name for %s¥n"</span>, className);
<a name="l00951"></a>00951             <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(msg);
<a name="l00952"></a>00952             <a class="code" href="class_sgv_1_1_log.html#93dcad7dd4a6aa975f0430ed44851f59" title="ログへエラーメッセージを出力（書式指定可能．改行なし）...">Log::error</a>(msg);
<a name="l00953"></a>00953             <span class="keywordflow">return</span> NULL;
<a name="l00954"></a>00954         }
<a name="l00955"></a>00955 
<a name="l00956"></a>00956         SceneNode *node = NULL;
<a name="l00957"></a>00957         <a class="code" href="class_sgv_1_1_humanoid_node_map.html" title="ヒューマノイド形状における、ジョイント名、パーツ名と それらに対応す...">HumanoidNodeMap</a> *pNodeMap = NULL;
<a name="l00958"></a>00958 
<a name="l00959"></a>00959         <span class="comment">// X3Dファイルロード</span>
<a name="l00960"></a>00960         <span class="keywordflow">if</span> (!m_pX3D-&gt;<a class="code" href="class_sgv_1_1_x3_d.html#a9a25241c484f6f67876b956d96330e3" title="X3D/VRMLファイルをロードする.">loadX3DFromFile</a>(x3dFileName))
<a name="l00961"></a>00961         {
<a name="l00962"></a>00962             sprintf(msg, <span class="stringliteral">"failed to load (%s)¥n"</span>, x3dFileName);
<a name="l00963"></a>00963             <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">printMsg</a>(msg);
<a name="l00964"></a>00964             <a class="code" href="class_sgv_1_1_log.html#93dcad7dd4a6aa975f0430ed44851f59" title="ログへエラーメッセージを出力（書式指定可能．改行なし）...">Log::error</a>(msg);
<a name="l00965"></a>00965             <span class="keywordflow">return</span> NULL;
<a name="l00966"></a>00966         }
<a name="l00967"></a>00967 
<a name="l00968"></a>00968         <span class="comment">// Ogreシーンノード作成</span>
<a name="l00969"></a>00969         <span class="keywordflow">if</span> (!m_pX3D-&gt;<a class="code" href="class_sgv_1_1_x3_d.html#b27c50c5daaf61853b961569df8ff359" title="カレントX3DファイルはOpenHRPヒューマノイドか？">isOpenHRPHumanoidShape</a>())
<a name="l00970"></a>00970         {
<a name="l00971"></a>00971             <span class="comment">// 静止物</span>
<a name="l00972"></a>00972 <span class="preprocessor">#if 1</span>
<a name="l00973"></a>00973 <span class="preprocessor"></span><span class="comment">// FIX20110421(ExpSS)</span>
<a name="l00974"></a>00974             node = m_pX3D-&gt;<a class="code" href="class_sgv_1_1_x3_d.html#ed0de2d25da401a21d7a065e2ef68630" title="カレントX3Dファイルに対するOgreノードを作る">createStaticNode</a>(m_pSceneMgr, m_pMainShapeNode, entName);
<a name="l00975"></a>00975 <span class="preprocessor">#else</span>
<a name="l00976"></a>00976 <span class="preprocessor"></span><span class="comment">//          node = m_pX3D-&gt;createShapeNode(m_pSceneMgr, m_pMainShapeNode, entName);</span>
<a name="l00977"></a>00977 <span class="preprocessor">#endif</span>
<a name="l00978"></a>00978 <span class="preprocessor"></span>        }
<a name="l00979"></a>00979         <span class="keywordflow">else</span>
<a name="l00980"></a>00980         {
<a name="l00981"></a>00981             <span class="comment">// ヒューマノイド（OpenHRP形状）</span>
<a name="l00982"></a>00982             pNodeMap = <a class="code" href="class_sgv_1_1_main_window.html#9349a668ce565c540a171af8f48278c0" title="エンティティ名からHumanoidNodeMapを引く． エンティティがヒューマノイドで...">getHumanoidNodeMap</a>(entName);
<a name="l00983"></a>00983             <span class="keywordflow">if</span> (pNodeMap)
<a name="l00984"></a>00984             {
<a name="l00985"></a>00985                 <span class="comment">// ここには来ないはず．（念のため確認）</span>
<a name="l00986"></a>00986                 <a class="code" href="class_sgv_1_1_log.html#93dcad7dd4a6aa975f0430ed44851f59" title="ログへエラーメッセージを出力（書式指定可能．改行なし）...">Log::error</a>(<span class="stringliteral">"internal error. nodemap for (%s) already exists.¥n"</span>, entName);
<a name="l00987"></a>00987                 <span class="keywordflow">return</span> NULL;
<a name="l00988"></a>00988             }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990             pNodeMap = <span class="keyword">new</span> <a class="code" href="class_sgv_1_1_humanoid_node_map.html" title="ヒューマノイド形状における、ジョイント名、パーツ名と それらに対応す...">HumanoidNodeMap</a>();
<a name="l00991"></a>00991 
<a name="l00992"></a>00992             node = m_pX3D-&gt;<a class="code" href="class_sgv_1_1_x3_d.html#a07d507a6bc1db789d02ff4593cf3e40" title="OpenHRPノードを作る.">createOpenHRPNodes</a>(
<a name="l00993"></a>00993                 m_pSceneMgr,
<a name="l00994"></a>00994                 m_pMainShapeNode,
<a name="l00995"></a>00995                 entName,
<a name="l00996"></a>00996                 pNodeMap-&gt;<a class="code" href="class_sgv_1_1_humanoid_node_map.html#7eb2b2008b0b05a87881d51cf557c9c8" title="ジョイント名とOgreノードのマップへの参照を返す">getJointMap</a>(),
<a name="l00997"></a>00997                 pNodeMap-&gt;<a class="code" href="class_sgv_1_1_humanoid_node_map.html#f89e5d439fbeacf768272a8500cef3e8" title="パーツ名とOgreノードのマップへの参照を返す">getPartsMap</a>(),
<a name="l00998"></a>00998                 <span class="keyword">true</span>,
<a name="l00999"></a>00999                 <span class="keyword">true</span>);
<a name="l01000"></a>01000         }
<a name="l01001"></a>01001 
<a name="l01002"></a>01002         <span class="keywordflow">if</span> (node)
<a name="l01003"></a>01003         {
<a name="l01004"></a>01004             <span class="comment">// マップへの登録</span>
<a name="l01005"></a>01005             m_mapEntNameToShapeNode[entName] = node;
<a name="l01006"></a>01006             m_mapEntNameToHumanoidNodeMap[entName] = pNodeMap;  <span class="comment">// 静止物の場合はpNodeMap=NULLになる</span>
<a name="l01007"></a>01007         }
<a name="l01008"></a>01008 
<a name="l01009"></a>01009         <span class="keywordflow">return</span> node;
<a name="l01010"></a>01010     }
<a name="l01011"></a>01011 
<a name="l01012"></a><a class="code" href="class_sgv_1_1_main_window.html#78b08b8b5fecc75b6dab54aa65e43a08">01012</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#78b08b8b5fecc75b6dab54aa65e43a08" title="エンティティを削除する">MainWindow::deleteEntity</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *entName)
<a name="l01013"></a>01013     {
<a name="l01014"></a>01014         <span class="keywordflow">if</span> (!entName) <span class="keywordflow">return</span>;
<a name="l01015"></a>01015 
<a name="l01016"></a>01016         <span class="comment">// エンティティをXML世界から消す</span>
<a name="l01017"></a>01017         m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#2245358f7cf4c9e23c7417bdbb429384" title="XMLEntityを削除する.">deleteEntity</a>(entName);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019         <span class="comment">// エンティティに対するOgreノードを消す</span>
<a name="l01020"></a>01020         SceneNode *node = <a class="code" href="class_sgv_1_1_main_window.html#fa8ef5695a4c2a3bfcf93cf1e0d9a08f" title="エンティティ名からOgreノードを引く． 見つからないときはNULLが返る...">getEntityNode</a>(entName);
<a name="l01021"></a>01021         <span class="keywordflow">if</span> (node)
<a name="l01022"></a>01022         {
<a name="l01023"></a>01023             <span class="comment">// ExtEntityInfoを消す</span>
<a name="l01024"></a>01024             <a class="code" href="class_sgv_1_1_x3_d.html#2a1fe1bf0d32f860625989d30bb56ff0" title="シーンノードが持っているExtEntityInfoを開放する">X3D::deleteAllExtEntityInfo</a>(node);
<a name="l01025"></a>01025 
<a name="l01026"></a>01026             <span class="comment">// ManualObjectを消す</span>
<a name="l01027"></a>01027             <a class="code" href="class_sgv_1_1_x3_d.html#d28b8350c8800befef0a92dfff0d3bf1" title="シーンノードが持っている全てのManualObjectをシーンマネージャから消す...">X3D::destroyAllManualObjects</a>(m_pSceneMgr, node);
<a name="l01028"></a>01028 
<a name="l01029"></a>01029             <span class="comment">// このノードと、このノードが含むすべての子ノードを消す</span>
<a name="l01030"></a>01030             node-&gt;removeAndDestroyAllChildren();
<a name="l01031"></a>01031         }
<a name="l01032"></a>01032 
<a name="l01033"></a>01033         <span class="comment">// エンティティ名とOgreノードのマップから消す</span>
<a name="l01034"></a>01034         std::map&lt;std::string, SceneNode *&gt;::iterator i = m_mapEntNameToShapeNode.find(entName);
<a name="l01035"></a>01035         <span class="keywordflow">if</span> (i != m_mapEntNameToShapeNode.end())
<a name="l01036"></a>01036         {
<a name="l01037"></a>01037             m_mapEntNameToShapeNode.erase(i);
<a name="l01038"></a>01038         }
<a name="l01039"></a>01039 
<a name="l01040"></a>01040         <span class="comment">// エンティティがヒューマノイドなら、ヒューマノイドノードマップからも消す</span>
<a name="l01041"></a>01041         std::map&lt;std::string, HumanoidNodeMap *&gt;::iterator j = m_mapEntNameToHumanoidNodeMap.find(entName);
<a name="l01042"></a>01042         <span class="keywordflow">if</span> (j != m_mapEntNameToHumanoidNodeMap.end())
<a name="l01043"></a>01043         {
<a name="l01044"></a>01044             <span class="comment">// ノードマップオブジェクトを開放</span>
<a name="l01045"></a>01045             <a class="code" href="class_sgv_1_1_humanoid_node_map.html" title="ヒューマノイド形状における、ジョイント名、パーツ名と それらに対応す...">HumanoidNodeMap</a> *pNodeMap = j-&gt;second;
<a name="l01046"></a>01046             <span class="keywordflow">if</span> (pNodeMap) <span class="keyword">delete</span> pNodeMap;
<a name="l01047"></a>01047 
<a name="l01048"></a>01048             <span class="comment">// マップからも消す</span>
<a name="l01049"></a>01049             m_mapEntNameToHumanoidNodeMap.erase(j);
<a name="l01050"></a>01050         }
<a name="l01051"></a>01051 
<a name="l01052"></a>01052         <span class="comment">// 右パネルのエンティティ名選択コンボボックスからエントリを消す</span>
<a name="l01053"></a>01053         <a class="code" href="class_wgu_1_1_right_panel_proc___entity.html" title="パネルプロシージャクラス（右パネル：エンティティ）">Wgu::RightPanelProc_Entity</a> *proc = (<a class="code" href="class_wgu_1_1_right_panel_proc___entity.html" title="パネルプロシージャクラス（右パネル：エンティティ）">Wgu::RightPanelProc_Entity</a> *)(<a class="code" href="class_sgv_1_1_main_window.html#7c26a938ac8f241d743c89cce327c950" title="メインウィンドウ右のパネルのパネルプロシージャを得る">getRightPanelProc</a>(MainWindow::RIGHT_PANEL::RP_ENTITY));
<a name="l01054"></a>01054         <span class="keywordflow">if</span> (proc)
<a name="l01055"></a>01055         {
<a name="l01056"></a>01056             proc-&gt;<a class="code" href="class_wgu_1_1_right_panel_proc___entity.html#53af5e75dbff6731205b5b32e3ea128e" title="エンティティ名選択コンボボックスからエンティティ名を削除する...">deleteEntityNameFromEntityNameSelector</a>(entName);
<a name="l01057"></a>01057         }
<a name="l01058"></a>01058     }
<a name="l01059"></a>01059 
<a name="l01060"></a><a class="code" href="class_sgv_1_1_main_window.html#50ada0e01a384a938a52b2b701a36793">01060</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#50ada0e01a384a938a52b2b701a36793" title="クラス定義の変更を世界に反映させる">MainWindow::updateWorldWithClassDefinition</a>()
<a name="l01061"></a>01061     {
<a name="l01062"></a>01062         <span class="comment">// 世界内のエンティティをクラス定義に適合させる．</span>
<a name="l01063"></a>01063         <span class="comment">//</span>
<a name="l01064"></a>01064         <span class="comment">// 返り値は、（クラス定義が消滅したことにより）</span>
<a name="l01065"></a>01065         <span class="comment">// もはや世界に存在しないはずのエンティティ達の名前である．</span>
<a name="l01066"></a>01066         <span class="comment">//</span>
<a name="l01067"></a>01067         <span class="comment">// これらはいわば「現世と天国とのはざま」(=limbo)に浮遊している状態である．</span>
<a name="l01068"></a>01068         <span class="comment">// deleteEntity()によりXMLWorld、Ogreノードその他から完全に消し去り、成仏させる．</span>
<a name="l01069"></a>01069         std::vector&lt;std::string&gt; limboEntNames = m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#83fd52b70014c685d854628ccf01fa27" title="クラス定義を参照して 世界内のすべてのエンティティの内容を更新する...">updateWithClassDefinition</a>(&amp;m_entClassMgr);
<a name="l01070"></a>01070 
<a name="l01071"></a>01071         std::vector&lt;std::string&gt;::iterator i;
<a name="l01072"></a>01072         <span class="keywordflow">for</span> (i=limboEntNames.begin(); i!=limboEntNames.end(); i++)
<a name="l01073"></a>01073         {
<a name="l01074"></a>01074             <span class="keyword">const</span> <span class="keywordtype">char</span> *limboEntName = i-&gt;c_str();
<a name="l01075"></a>01075             <span class="keywordflow">if</span> (limboEntName)
<a name="l01076"></a>01076             {
<a name="l01077"></a>01077                 <a class="code" href="class_sgv_1_1_main_window.html#78b08b8b5fecc75b6dab54aa65e43a08" title="エンティティを削除する">deleteEntity</a>(limboEntName); <span class="comment">// 成仏させる</span>
<a name="l01078"></a>01078             }
<a name="l01079"></a>01079         }
<a name="l01080"></a>01080     }
<a name="l01081"></a>01081 
<a name="l01082"></a><a class="code" href="class_sgv_1_1_main_window.html#a956268d9ae24abab4e1ef124225e3bf">01082</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#a956268d9ae24abab4e1ef124225e3bf" title="現在マウスで選択中のエンティティ名をセット． NULLを与えると選択クリ...">MainWindow::setCurrSelectedEntName</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *entName)
<a name="l01083"></a>01083     {
<a name="l01084"></a>01084         <span class="keywordflow">if</span> (entName)
<a name="l01085"></a>01085         {
<a name="l01086"></a>01086             m_currSelectedEntName = entName;
<a name="l01087"></a>01087             m_currSelected = <span class="keyword">true</span>;
<a name="l01088"></a>01088         }
<a name="l01089"></a>01089         <span class="keywordflow">else</span>
<a name="l01090"></a>01090         {
<a name="l01091"></a>01091             m_currSelectedEntName = <span class="stringliteral">""</span>;
<a name="l01092"></a>01092             m_currSelected = <span class="keyword">false</span>;
<a name="l01093"></a>01093         }
<a name="l01094"></a>01094     }
<a name="l01095"></a>01095 
<a name="l01096"></a><a class="code" href="class_sgv_1_1_main_window.html#b1f34d0d37ba3734051701d741397182">01096</a>     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="class_sgv_1_1_main_window.html#b1f34d0d37ba3734051701d741397182" title="現在マウスで選択中のエンティティ名を返す">MainWindow::getCurrSelectedEntName</a>()
<a name="l01097"></a>01097     {
<a name="l01098"></a>01098         <span class="keywordflow">return</span> m_currSelected ? m_currSelectedEntName.c_str() : NULL;
<a name="l01099"></a>01099     }
<a name="l01100"></a>01100 
<a name="l01101"></a><a class="code" href="class_sgv_1_1_main_window.html#0678dc33ac30d0ef469429d1ea09117d">01101</a>     <span class="keywordtype">bool</span> <a class="code" href="class_sgv_1_1_main_window.html#0678dc33ac30d0ef469429d1ea09117d" title="現在マウスでエンティティを選択中か？">MainWindow::isEntitySelecting</a>()
<a name="l01102"></a>01102     {
<a name="l01103"></a>01103         <span class="keywordflow">return</span> m_currSelected;
<a name="l01104"></a>01104     }
<a name="l01105"></a>01105 
<a name="l01106"></a><a class="code" href="class_sgv_1_1_main_window.html#0d9dcaaa28eb7b797a5748ed31e3285d">01106</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#0d9dcaaa28eb7b797a5748ed31e3285d" title="現在マウスで選択中のエンティティはヒューマノイドである...">MainWindow::setCurrSelectedEntityIsHumanoid</a>(<span class="keywordtype">bool</span> bHumanoid)
<a name="l01107"></a>01107     {
<a name="l01108"></a>01108         m_currSelectedEntityIsHumanoid = bHumanoid;
<a name="l01109"></a>01109     }
<a name="l01110"></a>01110 
<a name="l01111"></a><a class="code" href="class_sgv_1_1_main_window.html#f6aee34d32e3292944c75e79483501a2">01111</a>     <span class="keywordtype">bool</span> <a class="code" href="class_sgv_1_1_main_window.html#f6aee34d32e3292944c75e79483501a2" title="現在マウスで選択中のエンティティ名はヒューマノイドか？...">MainWindow::isCurrSelectedEntityHumanoid</a>()
<a name="l01112"></a>01112     {
<a name="l01113"></a>01113         <span class="keywordflow">return</span> m_currSelectedEntityIsHumanoid;
<a name="l01114"></a>01114     }
<a name="l01115"></a>01115 
<a name="l01116"></a><a class="code" href="class_sgv_1_1_main_window.html#2f854a4ed8c0424c9c446fc01508a5ad">01116</a>     <span class="keywordtype">bool</span> <a class="code" href="class_sgv_1_1_main_window.html#2f854a4ed8c0424c9c446fc01508a5ad" title="形状追加モードか？">MainWindow::isShapeAddMode</a>()
<a name="l01117"></a>01117     {
<a name="l01118"></a>01118         <span class="keywordflow">if</span> (!m_pRightPanel) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01119"></a>01119 
<a name="l01120"></a>01120         HWND hwndPanel = m_pRightPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#5a3c8894227d6ee10572eac2f0deb550" title="指定パネルのウィンドウハンドルの取得">getPanelHWND</a>(RIGHT_PANEL::RP_ENTITY);
<a name="l01121"></a>01121         HWND hwndCheckbox = GetDlgItem(hwndPanel, <a class="code" href="resource_8h.html#629639bed1bcb8a41b7679765a279be8">IDC_ENT_OBJ_ADD_MODE</a>);
<a name="l01122"></a>01122         <span class="keywordflow">return</span> <a class="code" href="class_wgu_1_1_check_box.html#f145036fa0f5f2420730676b6742957c" title="チェック状態を調べる">Wgu::CheckBox::getCheck</a>(hwndCheckbox);
<a name="l01123"></a>01123     }
<a name="l01124"></a>01124 
<a name="l01125"></a><a class="code" href="class_sgv_1_1_main_window.html#dd90f01a2357bc760b7578e5d48224e5">01125</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#dd90f01a2357bc760b7578e5d48224e5">MainWindow::getAxisFixStateOnMoving</a>(<span class="keywordtype">bool</span> &amp;bXAxisFix, <span class="keywordtype">bool</span> &amp;bYAxisFix, <span class="keywordtype">bool</span> &amp;bZAxisFix)
<a name="l01126"></a>01126     {
<a name="l01127"></a>01127         HWND hwndPanel = <a class="code" href="class_sgv_1_1_main_window.html#621cfd3a9a6fc2de5ce9a09a5150f2a3" title="メインウィンドウ下のパネルのウィンドウハンドルを得る">getBottomPanelHWND</a>(BOTTOM_PANEL::BP_MSG);
<a name="l01128"></a>01128 
<a name="l01129"></a>01129         HWND hwndCheckX = GetDlgItem(hwndPanel, <a class="code" href="resource_8h.html#c560e241e215c26e514ce0767c94330d">IDC_FIX_AXIS_X</a>);
<a name="l01130"></a>01130         HWND hwndCheckY = GetDlgItem(hwndPanel, <a class="code" href="resource_8h.html#63c1b9db53cd9ec31d0c24c017239869">IDC_FIX_AXIS_Y</a>);
<a name="l01131"></a>01131         HWND hwndCheckZ = GetDlgItem(hwndPanel, <a class="code" href="resource_8h.html#ac3ff08605825a0d4af5ebeaf4f04b7d">IDC_FIX_AXIS_Z</a>);
<a name="l01132"></a>01132 
<a name="l01133"></a>01133         bXAxisFix = <a class="code" href="class_wgu_1_1_check_box.html#f145036fa0f5f2420730676b6742957c" title="チェック状態を調べる">Wgu::CheckBox::getCheck</a>(hwndCheckX);
<a name="l01134"></a>01134         bYAxisFix = <a class="code" href="class_wgu_1_1_check_box.html#f145036fa0f5f2420730676b6742957c" title="チェック状態を調べる">Wgu::CheckBox::getCheck</a>(hwndCheckY);
<a name="l01135"></a>01135         bZAxisFix = <a class="code" href="class_wgu_1_1_check_box.html#f145036fa0f5f2420730676b6742957c" title="チェック状態を調べる">Wgu::CheckBox::getCheck</a>(hwndCheckZ);
<a name="l01136"></a>01136     }
<a name="l01137"></a>01137 
<a name="l01138"></a><a class="code" href="class_sgv_1_1_main_window.html#460aba75fd2d45dca937832de8bd727f">01138</a>     <span class="keywordtype">int</span> <a class="code" href="class_sgv_1_1_main_window.html#460aba75fd2d45dca937832de8bd727f">MainWindow::getAxisFixStateOnRotation</a>()
<a name="l01139"></a>01139     {
<a name="l01140"></a>01140         HWND hwndPanel = <a class="code" href="class_sgv_1_1_main_window.html#621cfd3a9a6fc2de5ce9a09a5150f2a3" title="メインウィンドウ下のパネルのウィンドウハンドルを得る">getBottomPanelHWND</a>(BOTTOM_PANEL::BP_MSG);
<a name="l01141"></a>01141 
<a name="l01142"></a>01142         HWND hwndRadioNone = GetDlgItem(hwndPanel, <a class="code" href="resource_8h.html#a8221d62922f2718258468a8cb00b4d9">IDC_ROT_NO_RST</a>);
<a name="l01143"></a>01143         HWND hwndRadioX = GetDlgItem(hwndPanel, <a class="code" href="resource_8h.html#f4fb8ea3ed224ec301c28665db585b53">IDC_ROT_AXIS_X</a>);
<a name="l01144"></a>01144         HWND hwndRadioY = GetDlgItem(hwndPanel, <a class="code" href="resource_8h.html#789ccc7dca70c25d8a8bac7df24b7150">IDC_ROT_AXIS_Y</a>);
<a name="l01145"></a>01145         HWND hwndRadioZ = GetDlgItem(hwndPanel, <a class="code" href="resource_8h.html#64f42eb56917e7cf61fe20f3144905b7">IDC_ROT_AXIS_Z</a>);
<a name="l01146"></a>01146 
<a name="l01147"></a>01147         <span class="keywordtype">int</span> retValue = 0;
<a name="l01148"></a>01148         <span class="keywordflow">if</span> (<a class="code" href="class_wgu_1_1_radio_button.html#cdb6daee196367fd10bf5d6c6af28218" title="チェック状態を調べる">Wgu::RadioButton::getCheck</a>(hwndRadioNone)) retValue = 0;
<a name="l01149"></a>01149         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_wgu_1_1_radio_button.html#cdb6daee196367fd10bf5d6c6af28218" title="チェック状態を調べる">Wgu::RadioButton::getCheck</a>(hwndRadioX)) retValue = 1;
<a name="l01150"></a>01150         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_wgu_1_1_radio_button.html#cdb6daee196367fd10bf5d6c6af28218" title="チェック状態を調べる">Wgu::RadioButton::getCheck</a>(hwndRadioY)) retValue = 2;
<a name="l01151"></a>01151         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_wgu_1_1_radio_button.html#cdb6daee196367fd10bf5d6c6af28218" title="チェック状態を調べる">Wgu::RadioButton::getCheck</a>(hwndRadioZ)) retValue = 3;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153         <span class="keywordflow">return</span> retValue;
<a name="l01154"></a>01154     }
<a name="l01155"></a>01155 
<a name="l01156"></a><a class="code" href="class_sgv_1_1_main_window.html#1dc2e5cf847eed2f331656cd076680f3">01156</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#1dc2e5cf847eed2f331656cd076680f3" title="マウスカーソルの形状を設定する">MainWindow::showWaitCursor</a>(<span class="keywordtype">bool</span> b)
<a name="l01157"></a>01157     {
<a name="l01158"></a>01158         <span class="keyword">static</span> HCURSOR hWaitCursor = NULL;
<a name="l01159"></a>01159         <span class="keyword">static</span> HCURSOR hNormalCursor = NULL;
<a name="l01160"></a>01160 
<a name="l01161"></a>01161         <span class="keywordflow">if</span> (!hWaitCursor)
<a name="l01162"></a>01162         {
<a name="l01163"></a>01163             hWaitCursor = LoadCursor(NULL, IDC_WAIT);
<a name="l01164"></a>01164         }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166         <span class="keywordflow">if</span> (!hNormalCursor)
<a name="l01167"></a>01167         {
<a name="l01168"></a>01168             hNormalCursor = LoadCursor(NULL, IDC_ARROW);
<a name="l01169"></a>01169         }
<a name="l01170"></a>01170 
<a name="l01171"></a>01171         <span class="keywordflow">if</span> (b)
<a name="l01172"></a>01172         {
<a name="l01173"></a>01173             SetCursor(hWaitCursor);
<a name="l01174"></a>01174         }
<a name="l01175"></a>01175         <span class="keywordflow">else</span>
<a name="l01176"></a>01176         {
<a name="l01177"></a>01177             SetCursor(hNormalCursor);
<a name="l01178"></a>01178         }
<a name="l01179"></a>01179     }
<a name="l01180"></a>01180 
<a name="l01181"></a><a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce">01181</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#1c1fa10588fad4a949874d38a27a66ce" title="メッセージ表示領域にメッセージを追加する．">MainWindow::printMsg</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
<a name="l01182"></a>01182     {
<a name="l01183"></a>01183         <span class="keyword">static</span> <span class="keywordtype">bool</span> bFirstTime = <span class="keyword">true</span>;
<a name="l01184"></a>01184         <span class="keywordtype">char</span> msg[1024];
<a name="l01185"></a>01185         va_list arg;
<a name="l01186"></a>01186 
<a name="l01187"></a>01187         va_start(arg, format);
<a name="l01188"></a>01188         vsprintf(msg, format, arg);
<a name="l01189"></a>01189         va_end(arg);
<a name="l01190"></a>01190 
<a name="l01191"></a>01191         HWND hwndMsg = GetDlgItem(<a class="code" href="class_sgv_1_1_main_window.html#621cfd3a9a6fc2de5ce9a09a5150f2a3" title="メインウィンドウ下のパネルのウィンドウハンドルを得る">getBottomPanelHWND</a>(BOTTOM_PANEL::BP_MSG), <a class="code" href="resource_8h.html#f65bb24ea98671cbfcd4e06d4ba6d309">IDC_MSG</a>);
<a name="l01192"></a>01192         <span class="keywordflow">if</span> (bFirstTime)
<a name="l01193"></a>01193         {
<a name="l01194"></a>01194             bFirstTime = <span class="keyword">false</span>;
<a name="l01195"></a>01195 
<a name="l01196"></a>01196             <span class="comment">// エディットコントロールの最大格納文字数を変更する</span>
<a name="l01197"></a>01197             <span class="comment">// デフォルトでは65536文字までしか格納できない．</span>
<a name="l01198"></a>01198             <span class="comment">//</span>
<a name="l01199"></a>01199             <span class="comment">// WinNT/2000/XP/Vistaでは、EM_SETLIMITTEXTで</span>
<a name="l01200"></a>01200             <span class="comment">// WPARAMに0を設定すると最大文字数(2G)まで格納できるようになる</span>
<a name="l01201"></a>01201             ::SendMessage(hwndMsg, EM_SETLIMITTEXT, (WPARAM)m_MsgWindowLimitTextSize, (LPARAM)0);
<a name="l01202"></a>01202         }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204         <a class="code" href="class_wgu_1_1_edit_box.html#d46e4ecac38af344ea7caa55f4877272" title="エディットコントロールの末尾に文字列を追加する">Wgu::EditBox::addText</a>(hwndMsg, msg);
<a name="l01205"></a>01205     }
<a name="l01206"></a>01206 
<a name="l01207"></a><a class="code" href="class_sgv_1_1_main_window.html#e4fc39d8bb151c3fed3d4b0d0e81a090">01207</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#e4fc39d8bb151c3fed3d4b0d0e81a090" title="メインウィンドウタイトルバーを更新する">MainWindow::updateMainWindowTitle</a>()
<a name="l01208"></a>01208     {
<a name="l01209"></a>01209         <span class="keywordtype">char</span> buf[1024];
<a name="l01210"></a>01210 
<a name="l01211"></a>01211         std::string fname = <a class="code" href="namespace_sgv.html#99e929b7e517ee2c6062211ee229fcaf" title="パス名からファイル名部分を抽出する">Sgv::extractFileNameFromPathName</a>(m_world.<a class="code" href="class_sgv_1_1_x_m_l_world.html#71319626da0ba6e3cdc137c438e0cff6" title="現在編集中の世界のXMLファイル名を返す 最後にロードまたはセーブしたフ...">getWorldFileName</a>());
<a name="l01212"></a>01212 
<a name="l01213"></a>01213         sprintf(buf, <span class="stringliteral">"SIGWorldEditor [%s]"</span>, fname.c_str());
<a name="l01214"></a>01214 
<a name="l01215"></a>01215         ::SetWindowText(m_hwndMain, (LPCSTR)buf);
<a name="l01216"></a>01216     }
<a name="l01217"></a>01217 
<a name="l01218"></a><a class="code" href="class_sgv_1_1_main_window.html#b9e2b81b65b5fd86b7b33a5b7a876779">01218</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#b9e2b81b65b5fd86b7b33a5b7a876779" title="パネルのサイズをメインウィンドウのサイズに合わせて変更する...">MainWindow::adjustControlPositions</a>()
<a name="l01219"></a>01219     {
<a name="l01220"></a>01220         <span class="comment">// コントロール、Ogreウィンドウの位置、サイズを変える</span>
<a name="l01221"></a>01221 
<a name="l01222"></a>01222         <span class="comment">// パラメータ入力用パネルの親ウィンドウ</span>
<a name="l01223"></a>01223         <a class="code" href="namespace_wgu.html#c80b973d735802833e47845d25f6b706" title="コントロールの位置、サイズを変える">Wgu::setControlPosition</a>(m_hwndMain, <a class="code" href="resource_8h.html#64828c87e47ccb41d2e1751edb4b20f6">IDC_RIGHT_STATIC</a>, 200, 10, 25, 190, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l01224"></a>01224 
<a name="l01225"></a>01225         <span class="comment">// 画面下部のタブ付きパネル</span>
<a name="l01226"></a>01226         <a class="code" href="namespace_wgu.html#c80b973d735802833e47845d25f6b706" title="コントロールの位置、サイズを変える">Wgu::setControlPosition</a>(m_hwndMain, <a class="code" href="resource_8h.html#c6f2cd21ede4a6639d707bbd91d32fd7">IDC_BOTTOM_TAB</a>, 10, 10, 160, 20, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l01227"></a>01227 
<a name="l01228"></a>01228         <span class="comment">// 画面右部のタブ付きパネル</span>
<a name="l01229"></a>01229         <a class="code" href="namespace_wgu.html#c80b973d735802833e47845d25f6b706" title="コントロールの位置、サイズを変える">Wgu::setControlPosition</a>(m_hwndMain, <a class="code" href="resource_8h.html#bb803809b0cb522f1fcae0df236fbc0f">IDC_RIGHT_TAB</a>, 200, 10, 5, 190, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l01230"></a>01230 
<a name="l01231"></a>01231         <span class="comment">// 形状表示ウィンドウ</span>
<a name="l01232"></a>01232         <a class="code" href="namespace_wgu.html#7b33e7caa79420f4ccf8db7d76dc2b48" title="ウィンドウの位置、サイズを変更する">Wgu::setWindowPosition</a>(m_hwndMain, <a class="code" href="class_sgv_1_1_main_window.html#7a52cdce718551696499887dfd95f96e" title="Ogreクライアントウィンドウを返す.">getOgreClientWindow</a>()-&gt;<a class="code" href="class_sgv_1_1_main_window.html#7f96976d6582a23639c4f2a2cb0fb69c" title="メインウィンドウハンドルを返す">getHWND</a>(), 10, 220, 10, 180, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l01233"></a>01233     }
<a name="l01234"></a>01234 
<a name="l01235"></a>01235     <span class="keywordtype">double</span> MainWindow::genRand(<span class="keywordtype">double</span> minValue, <span class="keywordtype">double</span> maxValue)
<a name="l01236"></a>01236     {
<a name="l01237"></a>01237         <span class="keyword">static</span> <span class="keywordtype">bool</span> bFirstTime = <span class="keyword">true</span>;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239         <span class="keywordflow">if</span> (bFirstTime)
<a name="l01240"></a>01240         {
<a name="l01241"></a>01241             srand((<span class="keywordtype">unsigned</span>)time(NULL));
<a name="l01242"></a>01242             bFirstTime = <span class="keyword">false</span>;
<a name="l01243"></a>01243         }
<a name="l01244"></a>01244 
<a name="l01245"></a>01245         <span class="keywordtype">double</span> r = (double)rand() / RAND_MAX;
<a name="l01246"></a>01246         <span class="keywordflow">return</span> r*(maxValue-minValue)+minValue;
<a name="l01247"></a>01247     }
<a name="l01248"></a>01248 
<a name="l01249"></a>01249     <span class="comment">// create arrow</span>
<a name="l01250"></a>01250     <span class="comment">// origin: (0, 0, 0)</span>
<a name="l01251"></a>01251     <span class="comment">// towards: (0, 0, -1)</span>
<a name="l01252"></a>01252     <span class="comment">//</span>
<a name="l01253"></a>01253     <span class="comment">// [[ remark ]]</span>
<a name="l01254"></a>01254     <span class="comment">// why towards vector's z-coord is -1 ?</span>
<a name="l01255"></a>01255     <span class="comment">// because Ogre's default forward direction is from +z to -z.</span>
<a name="l01256"></a>01256     <span class="comment">// parhaps you would think it's strange, but with following example</span>
<a name="l01257"></a>01257     <span class="comment">// you'll find it's reasonable.</span>
<a name="l01258"></a>01258     <span class="comment">//</span>
<a name="l01259"></a>01259     <span class="comment">// (ex)</span>
<a name="l01260"></a>01260     <span class="comment">//  SceneNode *node = createArrow(parent, "test_arrow");</span>
<a name="l01261"></a>01261     <span class="comment">//  node-&gt;setDirection(0, 0, 1);</span>
<a name="l01262"></a>01262     <span class="comment">//</span>
<a name="l01263"></a>01263     <span class="comment">//  by this code, arrow's direction is from (0, 0, 0) to (0, 0, 1).</span>
<a name="l01264"></a>01264     <span class="comment">//  this is expected (natural) behavior.</span>
<a name="l01265"></a>01265     <span class="comment">//</span>
<a name="l01266"></a><a class="code" href="class_sgv_1_1_main_window.html#fcc750e6018341297305b836c1a8e8b8">01266</a>     SceneNode *<a class="code" href="class_sgv_1_1_main_window.html#fcc750e6018341297305b836c1a8e8b8" title="矢印を作成する">MainWindow::createArrow</a>(SceneNode *parentNode, <span class="keywordtype">char</span> *name, ColourValue arrowColor, <span class="keywordtype">double</span> length)
<a name="l01267"></a>01267     {
<a name="l01268"></a>01268         <span class="keywordflow">if</span> (!parentNode) <span class="keywordflow">return</span> NULL;
<a name="l01269"></a>01269 
<a name="l01270"></a>01270         <span class="comment">// simple manual object</span>
<a name="l01271"></a>01271         ManualObject* arrow = m_pSceneMgr-&gt;createManualObject(name);
<a name="l01272"></a>01272 
<a name="l01273"></a>01273         <span class="comment">// the difinition of "MA_White" material is in ColorBall.material file.</span>
<a name="l01274"></a>01274         arrow-&gt;begin(<span class="stringliteral">"MA_White"</span>, RenderOperation::OT_LINE_LIST);
<a name="l01275"></a>01275 
<a name="l01276"></a>01276         <span class="comment">// 1</span>
<a name="l01277"></a>01277         arrow-&gt;position(0, 0, 0);
<a name="l01278"></a>01278         arrow-&gt;colour(arrowColor);
<a name="l01279"></a>01279 
<a name="l01280"></a>01280         arrow-&gt;position(0, 0, -length);
<a name="l01281"></a>01281         arrow-&gt;colour(arrowColor);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283         <span class="comment">// 2</span>
<a name="l01284"></a>01284         arrow-&gt;position(0, 0, -length);
<a name="l01285"></a>01285         arrow-&gt;colour(arrowColor);
<a name="l01286"></a>01286 
<a name="l01287"></a>01287         arrow-&gt;position(-0.1, 0, -(length-0.2));
<a name="l01288"></a>01288         arrow-&gt;colour(arrowColor);
<a name="l01289"></a>01289 
<a name="l01290"></a>01290         <span class="comment">// 3</span>
<a name="l01291"></a>01291         arrow-&gt;position(-0.1, 0, -(length-0.2));
<a name="l01292"></a>01292         arrow-&gt;colour(arrowColor);
<a name="l01293"></a>01293 
<a name="l01294"></a>01294         arrow-&gt;position(0.1, 0, -(length-0.2));
<a name="l01295"></a>01295         arrow-&gt;colour(arrowColor);
<a name="l01296"></a>01296 
<a name="l01297"></a>01297         <span class="comment">// 4</span>
<a name="l01298"></a>01298         arrow-&gt;position(0.1, 0, -(length-0.2));
<a name="l01299"></a>01299         arrow-&gt;colour(arrowColor);
<a name="l01300"></a>01300 
<a name="l01301"></a>01301         arrow-&gt;position(0, 0, -length);
<a name="l01302"></a>01302         arrow-&gt;colour(arrowColor);
<a name="l01303"></a>01303 
<a name="l01304"></a>01304         ManualObject::ManualObjectSection *sec = arrow-&gt;end();
<a name="l01305"></a>01305         <span class="keywordflow">if</span> (sec)
<a name="l01306"></a>01306         {
<a name="l01307"></a>01307             MaterialPtr mat = sec-&gt;getMaterial();
<a name="l01308"></a>01308             mat-&gt;setLightingEnabled(<span class="keyword">false</span>); <span class="comment">// disable lighting calc.</span>
<a name="l01309"></a>01309         }
<a name="l01310"></a>01310 
<a name="l01311"></a>01311         arrow-&gt;setQueryFlags(<a class="code" href="class_sgv_1_1_main_window.html#299b12fb4b0795a1cc0ceda102b80adb090072cffc84bd81caf6bb9b8623b720" title="クエリー検索対象にしない">Sgv::MainWindow::NO_SELECTION_TARGET</a>);
<a name="l01312"></a>01312 
<a name="l01313"></a>01313         SceneNode *node = parentNode-&gt;createChildSceneNode();
<a name="l01314"></a>01314         node-&gt;attachObject(arrow);
<a name="l01315"></a>01315 
<a name="l01316"></a>01316         <span class="keywordflow">return</span> node;
<a name="l01317"></a>01317     }
<a name="l01318"></a>01318 
<a name="l01319"></a><a class="code" href="class_sgv_1_1_main_window.html#6a1e6d71c06a83154bafa68eab118af3">01319</a>     SceneNode *<a class="code" href="class_sgv_1_1_main_window.html#6a1e6d71c06a83154bafa68eab118af3" title="平面グリッドを作成する">MainWindow::createPlane</a>(SceneNode *parentNode, <span class="keywordtype">int</span> planeSize, <span class="keywordtype">int</span> planeStep, <span class="keyword">const</span> <span class="keywordtype">char</span> *planeName)
<a name="l01320"></a>01320     {
<a name="l01321"></a>01321         <span class="keywordflow">if</span> (!parentNode) <span class="keywordflow">return</span> NULL;
<a name="l01322"></a>01322 
<a name="l01323"></a>01323         <span class="comment">// simple manual object</span>
<a name="l01324"></a>01324         ManualObject* plane = m_pSceneMgr-&gt;createManualObject(planeName);
<a name="l01325"></a>01325 
<a name="l01326"></a>01326         <span class="comment">// the difinition of "MA_White" material is</span>
<a name="l01327"></a>01327         <span class="comment">// in media/materials/scripts/BasicColor.material file.</span>
<a name="l01328"></a>01328         plane-&gt;begin(<span class="stringliteral">"MA_White"</span>, RenderOperation::OT_LINE_LIST);
<a name="l01329"></a>01329 
<a name="l01330"></a>01330         ColourValue col;
<a name="l01331"></a>01331         col.r = 0.0f;
<a name="l01332"></a>01332         col.g = 0.0f;
<a name="l01333"></a>01333         col.b = 0.6f;
<a name="l01334"></a>01334 
<a name="l01335"></a>01335         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=-planeSize; x&lt;=planeSize; x+=planeStep)
<a name="l01336"></a>01336         {
<a name="l01337"></a>01337             plane-&gt;position(x, 0.0, -planeSize);
<a name="l01338"></a>01338             plane-&gt;colour(col);
<a name="l01339"></a>01339 
<a name="l01340"></a>01340             plane-&gt;position(x, 0.0, planeSize);
<a name="l01341"></a>01341             plane-&gt;colour(col);
<a name="l01342"></a>01342         }
<a name="l01343"></a>01343 
<a name="l01344"></a>01344         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> z=-planeSize; z&lt;=planeSize; z+=planeStep)
<a name="l01345"></a>01345         {
<a name="l01346"></a>01346             plane-&gt;position(-planeSize, 0.0, z);
<a name="l01347"></a>01347             plane-&gt;colour(col);
<a name="l01348"></a>01348 
<a name="l01349"></a>01349             plane-&gt;position(planeSize, 0.0, z);
<a name="l01350"></a>01350             plane-&gt;colour(col);
<a name="l01351"></a>01351         }
<a name="l01352"></a>01352 
<a name="l01353"></a>01353         ManualObject::ManualObjectSection *sec = plane-&gt;end();
<a name="l01354"></a>01354         <span class="keywordflow">if</span> (sec)
<a name="l01355"></a>01355         {
<a name="l01356"></a>01356             MaterialPtr mat = sec-&gt;getMaterial();
<a name="l01357"></a>01357             mat-&gt;setLightingEnabled(<span class="keyword">false</span>); <span class="comment">// disable lighting calc.</span>
<a name="l01358"></a>01358         }
<a name="l01359"></a>01359 
<a name="l01360"></a>01360         plane-&gt;setQueryFlags(<a class="code" href="class_sgv_1_1_main_window.html#299b12fb4b0795a1cc0ceda102b80adb090072cffc84bd81caf6bb9b8623b720" title="クエリー検索対象にしない">Sgv::MainWindow::NO_SELECTION_TARGET</a>);
<a name="l01361"></a>01361 
<a name="l01362"></a>01362         SceneNode *node = parentNode-&gt;createChildSceneNode();
<a name="l01363"></a>01363         node-&gt;attachObject(plane);
<a name="l01364"></a>01364 
<a name="l01365"></a>01365         <span class="keywordflow">return</span> node;
<a name="l01366"></a>01366     }
<a name="l01367"></a>01367 
<a name="l01368"></a><a class="code" href="class_sgv_1_1_main_window.html#bd3893f78964eccbea2adb32e847deea">01368</a>     SceneNode *<a class="code" href="class_sgv_1_1_main_window.html#bd3893f78964eccbea2adb32e847deea" title="ウィンドウの(x, y)にあるエンティティの属するノードを返す...">MainWindow::getNodeAtScreenCoord</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <a class="code" href="class_sgv_1_1_ext_entity_info.html" title="Ogreエンティティに持たせる追加情報.">ExtEntityInfo</a> **ppExtInfo)
<a name="l01369"></a>01369     {
<a name="l01370"></a>01370         <span class="keywordflow">if</span> (!m_pSceneMgr || !m_pRenderWindow || !m_pCamera) <span class="keywordflow">return</span> NULL;
<a name="l01371"></a>01371 
<a name="l01372"></a>01372         <span class="keywordtype">int</span> w = m_pRenderWindow-&gt;getWidth();
<a name="l01373"></a>01373         <span class="keywordtype">int</span> h = m_pRenderWindow-&gt;getHeight();
<a name="l01374"></a>01374 
<a name="l01375"></a>01375         Ray ray = m_pCamera-&gt;getCameraToViewportRay(x/<span class="keywordtype">float</span>(w), y/<span class="keywordtype">float</span>(h));
<a name="l01376"></a>01376 
<a name="l01377"></a>01377         <span class="keywordflow">if</span> (!m_RaySceneQuery)
<a name="l01378"></a>01378         {
<a name="l01379"></a>01379             m_RaySceneQuery = m_pSceneMgr-&gt;createRayQuery(ray);
<a name="l01380"></a>01380         }
<a name="l01381"></a>01381         <span class="keywordflow">else</span>
<a name="l01382"></a>01382         {
<a name="l01383"></a>01383             m_RaySceneQuery-&gt;setRay(ray);
<a name="l01384"></a>01384         }
<a name="l01385"></a>01385 
<a name="l01386"></a>01386         <span class="comment">// 距離でソート．返り値の個数は高々1個．</span>
<a name="l01387"></a>01387         m_RaySceneQuery-&gt;setSortByDistance(<span class="keyword">true</span>, 1);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389         <span class="comment">// クエリーマスクを設定して、余計なオブジェクトを取得対象から外す</span>
<a name="l01390"></a>01390         m_RaySceneQuery-&gt;setQueryMask(<a class="code" href="class_sgv_1_1_main_window.html#299b12fb4b0795a1cc0ceda102b80adba2e42948de7f17a4aab01e68c4a41a59" title="クエリー検索対象にする">MainWindow::SELECTION_TARGET</a>);
<a name="l01391"></a>01391 
<a name="l01392"></a>01392         RaySceneQueryResult &amp;result = m_RaySceneQuery-&gt;execute();
<a name="l01393"></a>01393         RaySceneQueryResult::iterator itr = result.begin();
<a name="l01394"></a>01394 
<a name="l01395"></a>01395         <span class="keywordflow">if</span> (itr != result.end())
<a name="l01396"></a>01396         {
<a name="l01397"></a>01397             <span class="comment">// 発見</span>
<a name="l01398"></a>01398             Entity *ent = (Entity *)itr-&gt;movable;
<a name="l01399"></a>01399 
<a name="l01400"></a>01400             <span class="comment">// 拡張情報がある場合は呼び出し元へ返す</span>
<a name="l01401"></a>01401             <a class="code" href="class_sgv_1_1_ext_entity_info.html" title="Ogreエンティティに持たせる追加情報.">ExtEntityInfo</a> *ei = (<a class="code" href="class_sgv_1_1_ext_entity_info.html" title="Ogreエンティティに持たせる追加情報.">ExtEntityInfo</a> *)(ent-&gt;getUserObject());
<a name="l01402"></a>01402             <span class="keywordflow">if</span> (ei &amp;&amp; ppExtInfo)
<a name="l01403"></a>01403             {
<a name="l01404"></a>01404                 *ppExtInfo = ei;
<a name="l01405"></a>01405             }
<a name="l01406"></a>01406 
<a name="l01407"></a>01407             <span class="keywordflow">return</span> (SceneNode *)(ent-&gt;getParentNode());
<a name="l01408"></a>01408         }
<a name="l01409"></a>01409         <span class="keywordflow">else</span>
<a name="l01410"></a>01410         {
<a name="l01411"></a>01411             <span class="keywordflow">return</span> NULL;
<a name="l01412"></a>01412         }
<a name="l01413"></a>01413     }
<a name="l01414"></a>01414 
<a name="l01415"></a><a class="code" href="class_sgv_1_1_main_window.html#4c595b439680ff79b3b2dbe47f4d6fc8">01415</a>     <span class="keywordtype">void</span> <a class="code" href="class_sgv_1_1_main_window.html#4c595b439680ff79b3b2dbe47f4d6fc8" title="定期的処理">MainWindow::process</a>()
<a name="l01416"></a>01416     {
<a name="l01417"></a>01417         m_root.renderOneFrame();
<a name="l01418"></a>01418     }
<a name="l01419"></a>01419 
<a name="l01420"></a><a class="code" href="namespace_sgv.html#72b3084c3f7f764848131794877712d9">01420</a>     LRESULT CALLBACK <a class="code" href="namespace_sgv.html#72b3084c3f7f764848131794877712d9">fMainWndProc</a>(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam)
<a name="l01421"></a>01421     {
<a name="l01422"></a>01422         <span class="keywordflow">return</span> <a class="code" href="_wgu_8cpp.html#e7d48c44eebfc4bc4aaf480c2ccb69b3">GetMainWindow</a>()-&gt;mainWndProc(hWnd, uMsg, wParam, lParam);
<a name="l01423"></a>01423     }
<a name="l01424"></a>01424 
<a name="l01425"></a><a class="code" href="class_sgv_1_1_main_window.html#facf3194423a58b6858af6bd420bfc1e">01425</a>     LRESULT CALLBACK <a class="code" href="class_sgv_1_1_main_window.html#facf3194423a58b6858af6bd420bfc1e" title="メインウィンドウプロシージャ">MainWindow::mainWndProc</a>(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam)
<a name="l01426"></a>01426     {
<a name="l01427"></a>01427         <span class="keywordflow">if</span> (uMsg == WM_CREATE)
<a name="l01428"></a>01428         {
<a name="l01429"></a>01429 <span class="preprocessor">#if 0</span>
<a name="l01430"></a>01430 <span class="preprocessor"></span>            <span class="comment">// ステータスバーを作成する</span>
<a name="l01431"></a>01431             m_hwndStatus = <a class="code" href="class_wgu_1_1_status_bar.html#4782637983a39654affd2dafc5145ad2" title="ステータスバーウィンドウを作る">Wgu::StatusBar::create</a>(hWnd, ID_STATUSBAR);
<a name="l01432"></a>01432 
<a name="l01433"></a>01433             <span class="keywordflow">if</span> (!m_hwndStatus)
<a name="l01434"></a>01434             {
<a name="l01435"></a>01435                 DWORD err = GetLastError();
<a name="l01436"></a>01436                 <span class="keywordtype">char</span> buf[256];
<a name="l01437"></a>01437 
<a name="l01438"></a>01438                 sprintf(buf, <span class="stringliteral">"Status Window Create failed. err=(0x0%x)"</span>, err);
<a name="l01439"></a>01439                 MessageBox(NULL, buf, <span class="stringliteral">"error"</span>, MB_OK);
<a name="l01440"></a>01440             }
<a name="l01441"></a>01441 <span class="preprocessor">#endif</span>
<a name="l01442"></a>01442 <span class="preprocessor"></span>            <span class="keywordflow">return</span> 0;
<a name="l01443"></a>01443         }
<a name="l01444"></a>01444 
<a name="l01445"></a>01445         <span class="keywordflow">if</span> (m_pRenderWindow)
<a name="l01446"></a>01446         {
<a name="l01447"></a>01447             <a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html" title="パネルプロシージャクラス（下部パネル：メッセージ）">Wgu::BottomPanelProc_Msg</a> *rpMsg = (<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html" title="パネルプロシージャクラス（下部パネル：メッセージ）">Wgu::BottomPanelProc_Msg</a> *)(<a class="code" href="class_sgv_1_1_main_window.html#3a973b7677c1d4903c5c15026abef4d3" title="メインウィンドウ下のパネルのパネルプロシージャを得る">getBottomPanelProc</a>(BOTTOM_PANEL::BP_MSG));
<a name="l01448"></a>01448 
<a name="l01449"></a>01449             <span class="keywordflow">switch</span> (uMsg)
<a name="l01450"></a>01450             {
<a name="l01451"></a>01451             <span class="keywordflow">case</span> WM_COMMAND:
<a name="l01452"></a>01452                 {
<a name="l01453"></a>01453                     <span class="keywordflow">switch</span> (LOWORD(wParam))
<a name="l01454"></a>01454                     {
<a name="l01455"></a>01455                     <span class="keywordflow">case</span> <a class="code" href="resource_8h.html#5e8535155951b9d4c9b3691910fedf3e">ID_FILE_CREATENEWWORLD</a>:
<a name="l01456"></a>01456                         {
<a name="l01457"></a>01457                             <span class="keywordflow">if</span> (rpMsg) rpMsg-&gt;<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html#cd02955fa94eefdb0b74fb4efed0649a" title="新規世界作成ボタンが押された">onCreateNewWorld</a>(<span class="keyword">this</span>);
<a name="l01458"></a>01458                         }
<a name="l01459"></a>01459                         <span class="keywordflow">break</span>;
<a name="l01460"></a>01460 
<a name="l01461"></a>01461                     <span class="keywordflow">case</span> <a class="code" href="resource_8h.html#44b3d4b4d75969a7524ff0a587477281">ID_FILE_LOADWORLD</a>:
<a name="l01462"></a>01462                         {
<a name="l01463"></a>01463                             <span class="keywordflow">if</span> (rpMsg) rpMsg-&gt;<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html#3f03a765cb59eb5a40739a7ee3c3303d" title="世界XMLロードボタンが押された">onLoadWorldXML</a>(<span class="keyword">this</span>);
<a name="l01464"></a>01464                         }
<a name="l01465"></a>01465                         <span class="keywordflow">break</span>;
<a name="l01466"></a>01466 
<a name="l01467"></a>01467                     <span class="keywordflow">case</span> <a class="code" href="resource_8h.html#90d5a04927d35bb080ae888d7fce3ab3">ID_FILE_SAVEWORLD</a>:
<a name="l01468"></a>01468                         {
<a name="l01469"></a>01469                             <span class="keywordflow">if</span> (rpMsg) rpMsg-&gt;<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html#158c70e46080b29e54f3a8d8b3d4298a" title="世界XMLセーブボタンが押された">onSaveWorldXML</a>(<span class="keyword">this</span>);
<a name="l01470"></a>01470                         }
<a name="l01471"></a>01471                         <span class="keywordflow">break</span>;
<a name="l01472"></a>01472 
<a name="l01473"></a>01473                     <span class="keywordflow">case</span> <a class="code" href="resource_8h.html#afe47452af4842a94ea068177d875aa7">ID_FILE_SAVEWORLDAS</a>:
<a name="l01474"></a>01474                         {
<a name="l01475"></a>01475                             <span class="keywordflow">if</span> (rpMsg) rpMsg-&gt;<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html#2c930def27316e934f9bc43f6326d8c0" title="世界XMLセーブボタンが押された">onSaveAsWorldXML</a>(<span class="keyword">this</span>);
<a name="l01476"></a>01476                         }
<a name="l01477"></a>01477                         <span class="keywordflow">break</span>;
<a name="l01478"></a>01478 
<a name="l01479"></a>01479                     <span class="keywordflow">case</span> <a class="code" href="resource_8h.html#3a6cb842433474b721f52d5f3d23ebd4">ID_FILE_EXIT</a>:
<a name="l01480"></a>01480                         {
<a name="l01481"></a>01481                             <span class="keywordtype">bool</span> bExitCancel = <span class="keyword">false</span>;
<a name="l01482"></a>01482 
<a name="l01483"></a>01483                             <span class="keywordflow">if</span> (rpMsg)
<a name="l01484"></a>01484                             {
<a name="l01485"></a>01485                                 <span class="comment">// 未セーブの世界があるならセーブ</span>
<a name="l01486"></a>01486                                 <span class="keywordflow">if</span> (!rpMsg-&gt;<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html#fa3777da188f86c9fcc4cabcafd3518d" title="現在編集中の世界がセーブされていなければセーブを即すダイアログを出...">saveWorldIfModified</a>(<span class="keyword">this</span>))
<a name="l01487"></a>01487                                 {
<a name="l01488"></a>01488                                     <span class="comment">// Cancelボタンが押された</span>
<a name="l01489"></a>01489                                     bExitCancel = <span class="keyword">true</span>;
<a name="l01490"></a>01490                                 }
<a name="l01491"></a>01491                             }
<a name="l01492"></a>01492 
<a name="l01493"></a>01493                             <span class="keywordflow">if</span> (!bExitCancel)
<a name="l01494"></a>01494                             {
<a name="l01495"></a>01495                                 <span class="comment">// プログラム終了</span>
<a name="l01496"></a>01496                                 PostMessage(m_hwndMain, WM_CLOSE, 0, 0);
<a name="l01497"></a>01497                             }
<a name="l01498"></a>01498                         }
<a name="l01499"></a>01499                         <span class="keywordflow">break</span>;
<a name="l01500"></a>01500                     }
<a name="l01501"></a>01501                 }
<a name="l01502"></a>01502                 <span class="keywordflow">break</span>;
<a name="l01503"></a>01503 
<a name="l01504"></a>01504             <span class="keywordflow">case</span> WM_NOTIFY:
<a name="l01505"></a>01505                 {
<a name="l01506"></a>01506                     NMHDR *pnmhdr = (NMHDR *)lParam;
<a name="l01507"></a>01507                     <span class="keywordflow">switch</span> (pnmhdr-&gt;code)
<a name="l01508"></a>01508                     {
<a name="l01509"></a>01509                         <span class="keywordflow">case</span> TCN_SELCHANGE:
<a name="l01510"></a>01510                         {
<a name="l01511"></a>01511                             HWND hwndFrom = (HWND)pnmhdr-&gt;hwndFrom;
<a name="l01512"></a>01512                             <span class="keywordtype">int</span> iTab = TabCtrl_GetCurSel(hwndFrom);
<a name="l01513"></a>01513 
<a name="l01514"></a>01514                             <span class="keywordflow">if</span> (m_pBottomPanel-&gt;<a class="code" href="class_wgu_1_1_base_panel.html#ed5a99e9c69c95db33bb6596e3c641da" title="親ウィンドウハンドルの取得">getParentHWND</a>() == hwndFrom)
<a name="l01515"></a>01515                             {
<a name="l01516"></a>01516                                 m_pBottomPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#e920f231d122da567e0c93629f910f64" title="パネルを選択する">selectPanel</a>(iTab);
<a name="l01517"></a>01517                             }
<a name="l01518"></a>01518                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_pRightPanel-&gt;<a class="code" href="class_wgu_1_1_base_panel.html#ed5a99e9c69c95db33bb6596e3c641da" title="親ウィンドウハンドルの取得">getParentHWND</a>() == hwndFrom)
<a name="l01519"></a>01519                             {
<a name="l01520"></a>01520                                 m_pRightPanel-&gt;<a class="code" href="class_wgu_1_1_multi_panel.html#e920f231d122da567e0c93629f910f64" title="パネルを選択する">selectPanel</a>(iTab);
<a name="l01521"></a>01521                             }
<a name="l01522"></a>01522                         }
<a name="l01523"></a>01523                     }
<a name="l01524"></a>01524                 }
<a name="l01525"></a>01525                 <span class="keywordflow">break</span>;
<a name="l01526"></a>01526 
<a name="l01527"></a>01527             <span class="keywordflow">case</span> WM_ENTERSIZEMOVE:
<a name="l01528"></a>01528                 m_winSizing = <span class="keyword">true</span>;
<a name="l01529"></a>01529                 <span class="keywordflow">break</span>;
<a name="l01530"></a>01530 
<a name="l01531"></a>01531             <span class="keywordflow">case</span> WM_EXITSIZEMOVE:
<a name="l01532"></a>01532                 m_pRenderWindow-&gt;windowMovedOrResized();
<a name="l01533"></a>01533                 m_pRenderWindow-&gt;update();
<a name="l01534"></a>01534                 m_winSizing = <span class="keyword">false</span>;
<a name="l01535"></a>01535                 <span class="keywordflow">break</span>;
<a name="l01536"></a>01536 
<a name="l01537"></a>01537             <span class="keywordflow">case</span> WM_KEYDOWN:
<a name="l01538"></a>01538                 {
<a name="l01539"></a>01539                     <span class="keywordflow">if</span> (!m_bKeyPressing)
<a name="l01540"></a>01540                     {
<a name="l01541"></a>01541                         m_bKeyPressing = <span class="keyword">true</span>;
<a name="l01542"></a>01542 
<a name="l01543"></a>01543 <span class="preprocessor">#if 0</span>
<a name="l01544"></a>01544 <span class="preprocessor"></span>                        <span class="comment">// キーリピートなしの処理をしたいときはここに書く</span>
<a name="l01545"></a>01545                         <span class="keywordflow">switch</span> (wParam)
<a name="l01546"></a>01546                         {
<a name="l01547"></a>01547                         }
<a name="l01548"></a>01548 <span class="preprocessor">#endif</span>
<a name="l01549"></a>01549 <span class="preprocessor"></span>                    }
<a name="l01550"></a>01550                 }
<a name="l01551"></a>01551                 <span class="keywordflow">break</span>;
<a name="l01552"></a>01552 
<a name="l01553"></a>01553             <span class="keywordflow">case</span> WM_KEYUP:
<a name="l01554"></a>01554                 {
<a name="l01555"></a>01555                     m_bKeyPressing = <span class="keyword">false</span>;
<a name="l01556"></a>01556                 }
<a name="l01557"></a>01557                 <span class="keywordflow">break</span>;
<a name="l01558"></a>01558 
<a name="l01559"></a>01559             <span class="keywordflow">case</span> WM_MOVE:
<a name="l01560"></a>01560             <span class="keywordflow">case</span> WM_SIZE:
<a name="l01561"></a>01561                 {
<a name="l01562"></a>01562                     <span class="keywordtype">int</span> newWidth = LOWORD(lParam);
<a name="l01563"></a>01563                     <span class="keywordtype">int</span> newHeight = HIWORD(lParam);
<a name="l01564"></a>01564 
<a name="l01565"></a>01565                     <span class="comment">// コントロール、Ogreウィンドウの位置、サイズを変える</span>
<a name="l01566"></a>01566                     <a class="code" href="class_sgv_1_1_main_window.html#b9e2b81b65b5fd86b7b33a5b7a876779" title="パネルのサイズをメインウィンドウのサイズに合わせて変更する...">adjustControlPositions</a>();
<a name="l01567"></a>01567 
<a name="l01568"></a>01568                     <span class="comment">// ステータスバーのサイズを変える</span>
<a name="l01569"></a>01569                     <a class="code" href="class_wgu_1_1_status_bar.html#8f6fdf1bbe7a40634d5c91b7bc5a66ab" title="ステータスバーのサイズを調整する">Wgu::StatusBar::adjustSize</a>(m_hwndStatus, newWidth, newHeight, 10);
<a name="l01570"></a>01570                 }
<a name="l01571"></a>01571                 <span class="keywordflow">break</span>;
<a name="l01572"></a>01572 
<a name="l01573"></a>01573             <span class="keywordflow">case</span> WM_GETMINMAXINFO:
<a name="l01574"></a>01574                 <span class="comment">// Prevent the window from going smaller than some min size</span>
<a name="l01575"></a>01575                 ((MINMAXINFO*)lParam)-&gt;ptMinTrackSize.x = 100;
<a name="l01576"></a>01576                 ((MINMAXINFO*)lParam)-&gt;ptMinTrackSize.y = 100;
<a name="l01577"></a>01577                 <span class="keywordflow">break</span>;
<a name="l01578"></a>01578 
<a name="l01579"></a>01579             <span class="keywordflow">case</span> WM_SYSCOMMAND:
<a name="l01580"></a>01580                 <span class="keywordflow">if</span> (wParam == SC_CLOSE)
<a name="l01581"></a>01581                 {
<a name="l01582"></a>01582                     <span class="comment">// 未セーブの世界があるならセーブ</span>
<a name="l01583"></a>01583                     <span class="keywordflow">if</span> (rpMsg)
<a name="l01584"></a>01584                     {
<a name="l01585"></a>01585                         <span class="keywordflow">if</span> (!rpMsg-&gt;<a class="code" href="class_wgu_1_1_bottom_panel_proc___msg.html#fa3777da188f86c9fcc4cabcafd3518d" title="現在編集中の世界がセーブされていなければセーブを即すダイアログを出...">saveWorldIfModified</a>(<span class="keyword">this</span>))
<a name="l01586"></a>01586                         {
<a name="l01587"></a>01587                             <span class="comment">// Cancelボタンが押された</span>
<a name="l01588"></a>01588                             <span class="keywordflow">return</span> 0;
<a name="l01589"></a>01589                         }
<a name="l01590"></a>01590                     }
<a name="l01591"></a>01591                 }
<a name="l01592"></a>01592                 <span class="keywordflow">break</span>;
<a name="l01593"></a>01593 
<a name="l01594"></a>01594             <span class="keywordflow">case</span> WM_CLOSE:
<a name="l01595"></a>01595                 <a class="code" href="class_sgv_1_1_main_window.html#bf9be714baf6b1346f9843d35a843337" title="現在の設定値をSIGWE_settings.savに書き込む">saveSettingsFile</a>();
<a name="l01596"></a>01596                 PostQuitMessage(0);
<a name="l01597"></a>01597                 <span class="keywordflow">return</span> 0;
<a name="l01598"></a>01598             }
<a name="l01599"></a>01599         }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601         <span class="comment">// ここはDefWindowProcでよい．</span>
<a name="l01602"></a>01602         <span class="comment">// DefDlgProc()にしたら、「Add Entity to World」チェックボックスを</span>
<a name="l01603"></a>01603         <span class="comment">// 切り替えたとたん、まったくウィンドウが反応しなくなった．</span>
<a name="l01604"></a>01604 <span class="comment">//      return DefDlgProc(hWnd, uMsg, wParam, lParam);</span>
<a name="l01605"></a>01605         <span class="keywordflow">return</span> DefWindowProc(hWnd, uMsg, wParam, lParam);
<a name="l01606"></a>01606     }
<a name="l01607"></a>01607 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>SIGWorldEditorに対してThu Jun 9 10:52:58 2011に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
